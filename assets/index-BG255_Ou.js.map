{"version":3,"file":"index-BG255_Ou.js","sources":["../../ts/constants.ts","../../ts/math.ts","../../ts/state.ts","../../ts/interactive.ts","../../ts/catenary.ts","../../ts/rivet_calculator.ts","../../ts/computer.ts","../../ts/cogs_drawer.ts","../../ts/rivet_drawer.ts","../../ts/wheel_drawer.ts","../../ts/drawer.ts","../../ts/main.ts","../../ts/ui_input.ts","../../ts/ratio_finder.ts","../../ts/ratio_finder_ui.ts","../../ts/ui.ts","../../ts/init.ts"],"sourcesContent":["export const TWO_PI = 2 * Math.PI;\nexport const HALF_LINK = 25.4 / 2.0;\n\nexport const PHYSICS_CONSTANTS = {\n  MAX_ITERATIONS: 50,\n  ANGLE_STEP: 0.01,\n  ANGLE_TOLERANCE: 0.00000001,\n  COLLISION_TOLERANCE: 0.001,\n  CATENARY_POINTS: 100,\n  CATENARY_TOLERANCE: 0.0000001,\n} as const;\n","import { TWO_PI } from \"./constants.js\";\nimport type { CircleIntersectionResult } from \"./types.js\";\n\nexport class BikeGearingPoint {\n  static ZERO: BikeGearingPoint = new BikeGearingPoint(0, 0);\n\n  x: number;\n  y: number;\n\n  constructor(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n  }\n\n  static getArcEnd(r: number, a: number): BikeGearingPoint {\n    return new BikeGearingPoint(r * Math.cos(a), r * Math.sin(a));\n  }\n\n  dist(p: BikeGearingPoint): number {\n    return Math.hypot(this.x - p.x, this.y - p.y);\n  }\n\n  /**\n   * Return point between this and p at ratio\n   */\n  ratio(p: BikeGearingPoint, r: number): BikeGearingPoint {\n    return new BikeGearingPoint(\n      this.x + r * (p.x - this.x),\n      this.y + r * (p.y - this.y)\n    );\n  }\n\n  getAngle(p: BikeGearingPoint): number {\n    const dx = p.x - this.x;\n    const dy = p.y - this.y;\n    let a = 0;\n    if (Math.abs(dx) < 0.00001) {\n      if (dy > 0) {\n        a = Math.PI / 2;\n      } else {\n        a = -Math.PI / 2;\n      }\n    } else {\n      a = Math.atan(dy / dx);\n      if (dx < 0) {\n        a = a + Math.PI;\n      }\n    }\n    return a;\n  }\n}\n\nexport class BikeGearingCircle {\n  x: number;\n  y: number;\n  r: number;\n\n  constructor(x: number, y: number, r: number) {\n    this.x = x;\n    this.y = y;\n    this.r = r;\n  }\n\n  /**\n   * https://stackoverflow.com/a/68092269\n   */\n  intersection(c: BikeGearingCircle): CircleIntersectionResult {\n    // Start constructing the response object.\n    const result: CircleIntersectionResult = {\n      intersectCount: 0,\n      intersectOccurs: true,\n      oneIsInOther: false,\n      areEqual: false,\n      p1: new BikeGearingPoint(0, 0),\n      p2: new BikeGearingPoint(0, 0),\n    };\n\n    // Get vertical and horizontal distances between circles.\n    const dx = c.x - this.x;\n    const dy = c.y - this.y;\n\n    // Calculate the distance between the circle centers as a straight line.\n    const dist = Math.hypot(dy, dx);\n\n    // Check if circles intersect.\n    if (dist > this.r + c.r) {\n      result.intersectOccurs = false;\n    }\n\n    // Check one circle isn't inside the other.\n    if (dist < Math.abs(this.r - c.r)) {\n      result.intersectOccurs = false;\n      result.oneIsInOther = true;\n    }\n\n    // Check if circles are the same.\n    if (this.x === c.x && this.y === c.y && this.r === c.r) {\n      result.areEqual = true;\n    }\n\n    // Find the intersection points\n    if (result.intersectOccurs) {\n      // Centroid is the pt where two lines cross. A line between the circle centers\n      // and a line between the intersection points.\n      const centroid = (this.r * this.r - c.r * c.r + dist * dist) / (2.0 * dist);\n\n      // Get the coordinates of centroid.\n      const x2 = this.x + (dx * centroid) / dist;\n      const y2 = this.y + (dy * centroid) / dist;\n\n      // Get the distance from centroid to the intersection points.\n      const h = Math.sqrt(this.r * this.r - centroid * centroid);\n\n      // Get the x and y dist of the intersection points from centroid.\n      const rx = -dy * (h / dist);\n      const ry = dx * (h / dist);\n\n      // Get the intersection points.\n      result.p1.x = x2 + rx;\n      result.p1.y = y2 + ry;\n\n      result.p2.x = x2 - rx;\n      result.p2.y = y2 - ry;\n\n      // Add intersection count to results\n      if (result.areEqual) {\n        result.intersectCount = null;\n      } else if (result.p1.x === result.p2.x && result.p1.y === result.p2.y) {\n        result.intersectCount = 1;\n      } else {\n        result.intersectCount = 2;\n      }\n    }\n    return result;\n  }\n}\n\nexport function roundHuman(v: number, d: number): number {\n  return Math.round(v * Math.pow(10, d)) / Math.pow(10, d);\n}\n\nexport function toDegreesHuman(a: number): number {\n  return roundHuman((180.0 * a) / Math.PI, 1);\n}\n\nexport function comparableAngle(a1: number, a2: number): number {\n  let a = a2;\n  const minA = a1 - Math.PI / 2 - 0.01;\n  while (a < minA) {\n    a = a + TWO_PI;\n  }\n  const maxA = a1 + Math.PI / 2 + 0.01;\n  while (a > maxA) {\n    a = a - TWO_PI;\n  }\n  return a;\n}\n\n// https://stackoverflow.com/a/4652513\n// Reduce a fraction by finding the Greatest Common Divisor and dividing by it.\nexport function reduce(numerator: number, denominator: number): [number, number] {\n  const gcdFn = (a: number, b: number): number => {\n    return b ? gcdFn(b, a % b) : a;\n  };\n  const gcd = gcdFn(numerator, denominator);\n  return [numerator / gcd, denominator / gcd];\n}\n\nexport function computeSkidPatches(f: number, r: number): [number, number] {\n    // https://www.icebike.org/skid-patch-calculator/\n    const reduced = reduce(f, r);\n    if (reduced[0] % 2 === 0) {\n      return [reduced[1], reduced[1]];\n    } else {\n      return [reduced[1], reduced[1] * 2];\n    }\n}","import { HALF_LINK } from \"./constants.js\";\nimport { computeSkidPatches } from \"./math.js\";\n\nexport default class BikeGearingState {\n  private internalf: number = 51;\n  private internalr: number = 15;\n\n  // Teeth counts and derived properties\n  fda: number = 0;\n  fradius: number = 0;\n  rda: number = 0;\n  rradius: number = 0;\n\n  // Chainstay length (mm)\n  cs: number = 406;\n\n  // Chain length in rivets\n  cl: number = 98;\n\n  // Front angles and cog indices\n  fa: number = 0;\n  fcu: number = 0;\n  fru: number = 0;\n  fcb: number = 0;\n  frb: number = 0;\n\n  // Rear angles and cog indices\n  ra: number = 0;\n  rcu: number = 0;\n  rru: number = 0;\n  rcb: number = 0;\n  rrb: number = 0;\n\n  // Skid patches\n  skidPatchesSingleLegged: number = 0;\n  skidPatchesAmbidextrous: number = 0;\n\n  // State tracking\n  modified: string = \"\";\n\n  // Debug and simulation\n  debug: boolean = false;\n  debugCompute: boolean = false;\n  simulationSpeed: number = 1.0;\n  rotationSpeed: number = 80.0;\n  paused: boolean = false;\n\n  followRivet: boolean = false;\n\n  doDrawWheel: boolean = true;\n\n  halfLinkChain: number = HALF_LINK;\n\n  // Performance metrics\n  fps: number = 0.0;\n  t: number = 0.0;\n  speedkmh: number = 0;\n  rpm: number = 0;\n  computeLog: string = \"\";\n  drawDuration: number = 0;\n\n  constructor() {\n    this.f = 51;\n    this.r = 15;\n    this.reset();\n  }\n\n  reset(): void {\n    /** teeth front */\n    this.f = 51;\n    /** teeth rear */\n    this.r = 15;\n    /** chainstay (mm) */\n    this.cs = 406;\n    /** chain length in rivets (mm -> cl * 2.54 / 2) */\n    this.cl = 98;\n\n    /** angle front */\n    this.fa = 0;\n    /** cog hole number where chain is leaving front - up */\n    this.fcu = 0;\n    /** rivet number on fcu */\n    this.fru = 0;\n    /** cog hole number where chain is leaving front - bottom */\n    this.fcb = 0;\n    /** rivet number on fcb */\n    this.frb = 0;\n\n    /** angle rear */\n    this.ra = 0;\n    /** cog hole number where chain is leaving rear - up */\n    this.rcu = 0;\n    /** rivet number on rcu */\n    this.rru = 0;\n    /** cog hole number where chain is leaving rear - bottom */\n    this.rcb = 0;\n    /** rivet number on rcb */\n    this.rrb = 0;\n\n    this.modified = \"\";\n\n    this.debug = false;\n    this.debugCompute = false;\n    this.simulationSpeed = 1.0;\n    this.rotationSpeed = 80.0;\n    this.paused = false;\n\n    this.followRivet = false;\n\n    this.doDrawWheel = true;\n\n    this.halfLinkChain = HALF_LINK;\n\n    this.fps = 0.0;\n    this.t = 0.0;\n  }\n\n  /** Number of cogs front */\n  get f(): number {\n    return this.internalf;\n  }\n\n  /** Number of cogs front */\n  set f(value: number) {\n    this.internalf = value;\n    /** angle between two cogs - front */\n    this.fda = (2.0 * Math.PI) / this.internalf;\n    /** radius to rivet - front - drawing1.jpg */\n    this.fradius = HALF_LINK / 2 / Math.sin(this.fda / 2.0);\n    this.updateSkidPatches();\n  }\n\n  /** Number of teeth cogs rear */\n  get r(): number {\n    return this.internalr;\n  }\n\n  /** Number of teeth cogs rear */\n  set r(value: number) {\n    this.internalr = value;\n    /** angle between two cogs - rear */\n    this.rda = (2.0 * Math.PI) / this.internalr;\n    /** radius to rivet - rear - drawing1.jpg */\n    this.rradius = HALF_LINK / 2 / Math.sin(this.rda / 2.0);\n    this.updateSkidPatches();\n  }\n\n  updateSkidPatches(): void {\n    const skidPatched = computeSkidPatches(this.f, this.r)\n    this.skidPatchesSingleLegged = skidPatched[0];\n    this.skidPatchesAmbidextrous = skidPatched[1];\n  }\n\n  getRivetIndex(i: number): number {\n    while (i < 0) {\n      i = i + this.cl;\n    }\n    return i % this.cl;\n  }\n}\n","import type { CameraOffset, Point } from \"./types.js\";\n\n// Forward reference for BikeGearingMain to avoid circular dependency\ninterface MainInterface {\n  drawIfPaused(): void;\n}\n\nexport default class BikeGearingInteractive {\n  canvas: HTMLCanvasElement;\n  main: MainInterface;\n\n  maxZoom: number = 50;\n  minZoom: number = 0.5;\n\n  cameraOffset: CameraOffset = { x: 172, y: 358 };\n  cameraZoom: number = 2.0;\n  worldWidth: number = 650;\n\n  canvasBoundingClientRect: DOMRect | null = null;\n\n  initialPinchDistance: number | null = null;\n  initialPinchWorldPosition: Point | null = null;\n  initialPinchZoom: number | null = null;\n\n  isDragging: boolean = false;\n  dragStart: Point = { x: 0, y: 0 };\n  previousCameraOffset: CameraOffset | undefined;\n\n  constructor(canvas: HTMLCanvasElement, main: MainInterface) {\n    this.canvas = canvas;\n    this.main = main;\n  }\n\n  initInteractive(): void {\n    const canvas = this.canvas;\n\n    window.addEventListener(\"resize\", () => this.onResize());\n    canvas.addEventListener(\"mousedown\", (e) => this.onPointerDown(e));\n    canvas.addEventListener(\"touchstart\", (e) =>\n      this.handleTouch(e, (c) => this.onPointerDown(c))\n    );\n    canvas.addEventListener(\"mouseup\", (e) => this.onPointerUp(e));\n    canvas.addEventListener(\"touchend\", (e) =>\n      this.handleTouch(e, (c) => this.onPointerUp(c))\n    );\n    canvas.addEventListener(\"mousemove\", (e) => this.onPointerMove(e));\n    canvas.addEventListener(\"touchmove\", (e) =>\n      this.handleTouch(e, (c) => this.onPointerMove(c))\n    );\n    canvas.addEventListener(\"wheel\", (e) => this.adjustZoomWheel(e));\n  }\n\n  reset(): void {\n    this.cameraOffset = { x: 172, y: 358 };\n    this.cameraZoom = 2.0;\n    this.worldWidth = 650;\n    this.onResize();\n  }\n\n  onSidebar(width: number): void {\n    const worldPosition = this.getWorldPosition(\n      0,\n      0,\n      this.cameraOffset,\n      this.cameraZoom\n    );\n    this.cameraZoom =\n      (this.cameraZoom * (this.canvas.width - width)) / this.canvas.width;\n    this.cameraOffset.x = width - worldPosition.x * this.cameraZoom;\n  }\n\n  onResize(): void {\n    const parent = this.canvas.parentNode as HTMLElement;\n    const styles = getComputedStyle(parent);\n    const w = parseInt(styles.getPropertyValue(\"width\"), 10);\n    const h = parseInt(styles.getPropertyValue(\"height\"), 10);\n    this.canvas.width = w;\n    this.canvas.height = h;\n\n    this.canvasBoundingClientRect = this.canvas.getBoundingClientRect();\n    const oldCameraZoom = this.cameraZoom;\n    this.cameraZoom = this.canvas.width / this.worldWidth;\n    this.cameraOffset.x =\n      this.cameraOffset.x * (this.cameraZoom / oldCameraZoom);\n    this.cameraOffset.y =\n      this.cameraOffset.y * (this.cameraZoom / oldCameraZoom);\n    this.main.drawIfPaused();\n  }\n\n  getEventLocation(e: MouseEvent | TouchEvent): Point | undefined {\n    if (\"touches\" in e && e.touches && e.touches.length === 1) {\n      return {\n        x: e.touches[0].clientX - (this.canvasBoundingClientRect?.left ?? 0),\n        y: e.touches[0].clientY - (this.canvasBoundingClientRect?.top ?? 0),\n      };\n    } else if (\"clientX\" in e && e.clientX && e.clientY) {\n      return {\n        x: e.clientX - (this.canvasBoundingClientRect?.left ?? 0),\n        y: e.clientY - (this.canvasBoundingClientRect?.top ?? 0),\n      };\n    }\n    return undefined;\n  }\n\n  onPointerDown(e: MouseEvent | TouchEvent): void {\n    this.isDragging = true;\n    this.previousCameraOffset = {\n      x: this.cameraOffset.x,\n      y: this.cameraOffset.y,\n    };\n    const loc = this.getEventLocation(e);\n    if (loc) {\n      this.dragStart = loc;\n    }\n  }\n\n  onPointerUp(_e: MouseEvent | TouchEvent): void {\n    this.isDragging = false;\n    this.initialPinchDistance = null;\n    this.initialPinchWorldPosition = null;\n    this.initialPinchZoom = null;\n  }\n\n  onPointerMove(e: MouseEvent | TouchEvent): void {\n    if (this.isDragging && this.previousCameraOffset) {\n      const eventLocation = this.getEventLocation(e);\n      if (eventLocation) {\n        this.cameraOffset.x =\n          this.previousCameraOffset.x + eventLocation.x - this.dragStart.x;\n        this.cameraOffset.y =\n          this.previousCameraOffset.y + eventLocation.y - this.dragStart.y;\n        this.main.drawIfPaused();\n      }\n    }\n  }\n\n  adjustZoomWheel(e: WheelEvent): void {\n    if (!this.isDragging) {\n      const eventLocation = this.getEventLocation(e);\n      if (!eventLocation) return;\n\n      const worldPosition = this.getWorldPosition(\n        eventLocation.x,\n        eventLocation.y,\n        this.cameraOffset,\n        this.cameraZoom\n      );\n\n      const sens = e.deltaY / 1000.0;\n      let scale: number;\n      if (e.deltaY >= 0) {\n        scale = 1 - sens;\n      } else {\n        scale = 1 / (1 + sens);\n      }\n      this.adjustZoom(\n        eventLocation.x,\n        eventLocation.y,\n        worldPosition,\n        this.cameraZoom * scale\n      );\n    }\n  }\n\n  getWorldPosition(\n    clientX: number,\n    clientY: number,\n    offset: CameraOffset,\n    zoom: number\n  ): Point {\n    return {\n      x: (clientX - offset.x) / zoom,\n      y: (clientY - offset.y) / zoom,\n    };\n  }\n\n  adjustZoom(\n    clientX: number,\n    clientY: number,\n    worldPosition: Point,\n    newCameraZoom: number\n  ): void {\n    if (!this.isDragging) {\n      this.cameraZoom = newCameraZoom;\n      this.cameraZoom = Math.min(this.cameraZoom, this.maxZoom);\n      this.cameraZoom = Math.max(this.cameraZoom, this.minZoom);\n\n      this.cameraOffset.x = clientX - worldPosition.x * this.cameraZoom;\n      this.cameraOffset.y = clientY - worldPosition.y * this.cameraZoom;\n\n      this.worldWidth = this.canvas.width / this.cameraZoom;\n\n      this.main.drawIfPaused();\n    }\n  }\n\n  handleTouch(\n    e: TouchEvent,\n    singleTouchHandler: (e: TouchEvent) => void\n  ): void {\n    if (e.touches.length === 1) {\n      singleTouchHandler(e);\n    } else if (e.type === \"touchmove\" && e.touches.length === 2) {\n      this.isDragging = false;\n      this.handlePinch(e);\n    }\n  }\n\n  handlePinch(e: TouchEvent): void {\n    e.preventDefault();\n\n    const touch1 = { x: e.touches[0].clientX, y: e.touches[0].clientY };\n    const touch2 = { x: e.touches[1].clientX, y: e.touches[1].clientY };\n    const touchCenter = {\n      x: (touch1.x + touch2.x) / 2 - (this.canvasBoundingClientRect?.left ?? 0),\n      y: (touch1.y + touch2.y) / 2 - (this.canvasBoundingClientRect?.top ?? 0),\n    };\n\n    const currentDistance = Math.hypot(\n      touch1.x - touch2.x,\n      touch1.y - touch2.y\n    );\n\n    if (this.initialPinchDistance === null) {\n      this.initialPinchDistance = currentDistance;\n      this.initialPinchWorldPosition = this.getWorldPosition(\n        touchCenter.x,\n        touchCenter.y,\n        this.cameraOffset,\n        this.cameraZoom\n      );\n      this.initialPinchZoom = this.cameraZoom;\n    } else if (this.initialPinchWorldPosition && this.initialPinchZoom) {\n      this.adjustZoom(\n        touchCenter.x,\n        touchCenter.y,\n        this.initialPinchWorldPosition,\n        this.initialPinchZoom * (currentDistance / this.initialPinchDistance)\n      );\n    }\n  }\n}\n","import { BikeGearingPoint } from \"./math.js\";\nimport { PHYSICS_CONSTANTS } from \"./constants.js\";\n\nexport default class BikeGearingCatenary {\n  static getCatenaryPoints(\n    p1: BikeGearingPoint,\n    p2: BikeGearingPoint,\n    l: number\n  ): BikeGearingPoint[] {\n    // https://math.stackexchange.com/a/3557768\n    let x1: number, y1: number, x2: number, y2: number, inverted: boolean;\n    if (p1.x < p2.x) {\n      x1 = p1.x;\n      y1 = -p1.y;\n      x2 = p2.x;\n      y2 = -p2.y;\n      inverted = false;\n    } else {\n      x1 = p2.x;\n      y1 = -p2.y;\n      x2 = p1.x;\n      y2 = -p1.y;\n      inverted = true;\n    }\n    const dx = x2 - x1;\n    const dy = y2 - y1;\n    if (Math.sqrt(l * l) < Math.hypot(dx, dy) + 0.00001) {\n      return [p1, p2];\n    }\n\n    const ax = (x2 + x1) / 2;\n    const ay = (y2 + y1) / 2;\n\n    // l² <= dx² + dy²\n    // dx != 0\n    const r = Math.sqrt(l * l - dy * dy) / dx;\n    // r = sinh(A)/A\n    let A: number;\n    if (r < 3) {\n      A = Math.sqrt(6 * (r - 1));\n    } else {\n      A = Math.log(2 * r) + Math.log(Math.log(2 * r));\n    }\n    let diff = 0;\n    do {\n      A = A - (Math.sinh(A) - r * A) / (Math.cosh(A) - r);\n      diff = Math.abs(r - Math.sinh(A) / A);\n    } while (diff > PHYSICS_CONSTANTS.CATENARY_TOLERANCE);\n\n    const a = dx / (2 * A);\n    const b = ax - a * Math.atanh(dy / l);\n    const c = ay - l / (2 * Math.tanh(A));\n\n    const nPoints = PHYSICS_CONSTANTS.CATENARY_POINTS;\n    const points: BikeGearingPoint[] = [];\n    for (let i = 0; i <= nPoints; i++) {\n      const x = x1 + (i * (x2 - x1)) / nPoints;\n      const y = -(c + a * Math.cosh((x - b) / a));\n      points.push(new BikeGearingPoint(x, y));\n    }\n    if (inverted) {\n      points.reverse();\n    }\n    return points;\n  }\n\n  static getCatenaryIntervals(\n    p1: BikeGearingPoint,\n    p2: BikeGearingPoint,\n    l: number,\n    n: number\n  ): BikeGearingPoint[] {\n    const points = BikeGearingCatenary.getCatenaryPoints(p1, p2, l);\n\n    const dseg: number[] = [];\n    let dtot = 0;\n    for (let i = 0; i < points.length - 1; i++) {\n      const d = points[i].dist(points[i + 1]);\n      dtot = dtot + d;\n      dseg.push(d);\n    }\n\n    const result: BikeGearingPoint[] = [];\n\n    let d = 0;\n    let iseg = 0;\n    const dl = dtot / n;\n\n    for (let i = 0; i < dseg.length; i++) {\n      const nd = d + dseg[i];\n\n      let added = false;\n      do {\n        if (d - 0.001 <= iseg * dl && iseg * dl <= nd + 0.001) {\n          const r = (iseg * dl - d) / (nd - d);\n          const p = points[i].ratio(points[i + 1], r);\n          result.push(p);\n          iseg++;\n          added = true;\n        } else {\n          added = false;\n        }\n      } while (added);\n\n      d = nd;\n    }\n    return result;\n  }\n}\n","import { HALF_LINK } from \"./constants.js\";\nimport { BikeGearingPoint } from \"./math.js\";\nimport BikeGearingCatenary from \"./catenary.js\";\nimport BikeGearingState from \"./state.js\";\n\nexport default class BikeGearingRivetsCalculator {\n  state: BikeGearingState;\n\n  constructor(state: BikeGearingState) {\n    this.state = state;\n  }\n\n  // FIXME see getRivetIndex\n  getCogIndex(c: number, i: number): number {\n    while (i < 0) {\n      i = i + c;\n    }\n    return i % c;\n  }\n\n  getRivet(rivets: BikeGearingPoint[], i: number): BikeGearingPoint {\n    return rivets[this.state.getRivetIndex(i)];\n  }\n\n  getFrontCogPoint(c: number): BikeGearingPoint {\n    const a = this.state.fa - c * this.state.fda;\n    return new BikeGearingPoint(\n      this.state.cs + this.state.fradius * Math.cos(a),\n      this.state.fradius * Math.sin(a)\n    );\n  }\n\n  getRearCogPoint(c: number): BikeGearingPoint {\n    const a = this.state.ra - c * this.state.rda;\n    return new BikeGearingPoint(\n      this.state.rradius * Math.cos(a),\n      this.state.rradius * Math.sin(a)\n    );\n  }\n\n  getRivetsUp(rivets: BikeGearingPoint[]): void {\n    const s = this.getFrontCogPoint(this.state.fcu);\n    const e = this.getRearCogPoint(this.state.rcu);\n    const rc = this.state.getRivetIndex(this.state.rru - this.state.fru);\n    const points = BikeGearingCatenary.getCatenaryIntervals(\n      s,\n      e,\n      rc * HALF_LINK,\n      rc\n    );\n    for (let i = 0; i < points.length; i++) {\n      rivets.push(points[i]);\n    }\n  }\n\n  getRivetsRear(rivets: BikeGearingPoint[]): void {\n    const count = this.state.getRivetIndex(this.state.rrb - this.state.rru);\n    for (let i = 1; i < count; i++) {\n      const c = this.state.rcu + i;\n      const p = this.getRearCogPoint(c);\n      rivets.push(p);\n    }\n  }\n\n  getRivetsDown(rivets: BikeGearingPoint[]): void {\n    const s = this.getRearCogPoint(this.state.rcb);\n    const e = this.getFrontCogPoint(this.state.fcb);\n    const rc = this.state.getRivetIndex(this.state.frb - this.state.rrb);\n    const points = BikeGearingCatenary.getCatenaryIntervals(\n      s,\n      e,\n      rc * HALF_LINK,\n      rc\n    );\n    for (let i = 0; i < points.length; i++) {\n      rivets.push(points[i]);\n    }\n  }\n\n  getRivetsFront(rivets: BikeGearingPoint[]): void {\n    const count = this.state.getRivetIndex(this.state.fru - this.state.frb);\n    for (let i = 1; i < count; i++) {\n      const c = this.state.fcb + i;\n      const p = this.getFrontCogPoint(c);\n      rivets.push(p);\n    }\n  }\n\n  getRivets(): BikeGearingPoint[] {\n    const rivets: BikeGearingPoint[] = [];\n    this.getRivetsUp(rivets);\n    this.getRivetsRear(rivets);\n    this.getRivetsDown(rivets);\n    this.getRivetsFront(rivets);\n    const result: BikeGearingPoint[] = [];\n    for (let i = 0; i < this.state.cl; i++) {\n      result.push(rivets[this.state.getRivetIndex(i - this.state.fru)]);\n    }\n    return result;\n  }\n}\n","import { TWO_PI, HALF_LINK, PHYSICS_CONSTANTS } from \"./constants.js\";\nimport {\n  toDegreesHuman,\n  comparableAngle,\n  roundHuman,\n  BikeGearingPoint,\n  BikeGearingCircle,\n} from \"./math.js\";\nimport BikeGearingRivetsCalculator from \"./rivet_calculator.js\";\nimport BikeGearingState from \"./state.js\";\n\nexport default class BikeGearingComputer {\n  state: BikeGearingState;\n  rivetsCalculator: BikeGearingRivetsCalculator;\n  rivets: BikeGearingPoint[] = [];\n\n  onceModified: boolean = false;\n  modified: boolean = false;\n  broken: boolean = false;\n  iterations: number = 0;\n\n  constructor(\n    state: BikeGearingState,\n    rivetsCalculator: BikeGearingRivetsCalculator\n  ) {\n    this.state = state;\n    this.rivetsCalculator = rivetsCalculator;\n  }\n\n  reset(): void {\n    const state = this.state;\n    const alpha = Math.asin((state.f - state.r) / state.cs);\n    state.fa = -Math.PI / 2;\n    state.fcu = 0;\n    state.fru = 0;\n    const fdr = Math.round(state.f / 2.0);\n    state.fcb = state.fcu - fdr;\n    state.frb = state.fru - fdr;\n\n    state.ra = -Math.PI / 2;\n    const rdr = Math.round(state.r / 2.0);\n    state.rcu = 0;\n    state.rcb = state.rcu + rdr;\n    const rdiff = Math.round((state.cs * Math.cos(alpha)) / HALF_LINK) + 2;\n    if (state.rotationSpeed > 0) {\n      state.rru = rdiff;\n      state.rrb = state.rru + rdr;\n    } else {\n      state.rrb = state.frb - rdiff;\n      state.rru = state.rrb - rdr;\n    }\n\n    this.moduloState();\n  }\n\n  debugAngles(label: string, mina: number, ra: number, maxa: number): void {\n    if (this.state.debugCompute) {\n      console.log(\n        \"fixed :\" +\n          label +\n          \" - \" +\n          \" mina: \" +\n          toDegreesHuman(mina) +\n          \" ra: \" +\n          toDegreesHuman(ra) +\n          \" maxa: \" +\n          toDegreesHuman(maxa)\n      );\n    }\n  }\n\n  moduloState(): void {\n    const state = this.state;\n    state.fa = comparableAngle(0, state.fa);\n    state.fcu = (state.fcu + state.f) % state.f;\n    state.fru = (state.fru + state.cl) % state.cl;\n    state.fcb = (state.fcb + state.f) % state.f;\n    state.frb = (state.frb + state.cl) % state.cl;\n\n    state.ra = comparableAngle(0, state.ra);\n    state.rcu = (state.rcu + state.r) % state.r;\n    state.rru = (state.rru + state.cl) % state.cl;\n    state.rcb = (state.rcb + state.r) % state.r;\n    state.rrb = (state.rrb + state.cl) % state.cl;\n  }\n\n  setBroken(): void {\n    this.broken = true;\n    this.reset();\n    this.setModified();\n  }\n\n  setModified(): void {\n    this.rivets = this.rivetsCalculator.getRivets();\n    this.modified = true;\n    this.onceModified = true;\n  }\n\n  checkState(): void {\n    const state = this.state;\n    const fdr = this.state.getRivetIndex(state.fru - state.frb);\n    const fdc = this.rivetsCalculator.getCogIndex(state.f, state.fcu - state.fcb);\n    const rdr = this.state.getRivetIndex(state.rrb - state.rru);\n    const rdc = this.rivetsCalculator.getCogIndex(state.r, state.rcb - state.rcu);\n    if (fdr !== fdc || rdr !== rdc) {\n      console.error([\"invalid state\", state]);\n      this.setBroken();\n    }\n  }\n\n  chainTensionUp(): void {\n    const state = this.state;\n    const rivets = this.rivets;\n    const r1 = this.rivetsCalculator.getRivet(rivets, state.fru);\n    const r2 = this.rivetsCalculator.getRivet(rivets, state.rru);\n    const d = r1.dist(r2);\n    const maxDist =\n      state.halfLinkChain * this.state.getRivetIndex(state.rru - state.fru);\n    if (d >= maxDist) {\n      const inter = new BikeGearingCircle(r1.x, r1.y, maxDist).intersection(\n        new BikeGearingCircle(0, 0, state.rradius)\n      );\n      if (inter.intersectOccurs) {\n        let pinter: BikeGearingPoint;\n        if (inter.p1.y < 0) {\n          pinter = inter.p1 as BikeGearingPoint;\n        } else {\n          pinter = inter.p2 as BikeGearingPoint;\n        }\n        const currentRa = state.ra - state.rcu * state.rda;\n        const newRa = comparableAngle(\n          currentRa,\n          BikeGearingPoint.ZERO.getAngle(pinter)\n        );\n        if (Math.abs(newRa - currentRa) > PHYSICS_CONSTANTS.COLLISION_TOLERANCE) {\n          this.logCompute([\"fixed chain tension, da : \", newRa - currentRa]);\n          state.ra = state.ra + (newRa - currentRa);\n          this.setModified();\n        }\n      } else {\n        // broken, no intersection\n        this.logCompute([\"impossible to make chain tension\", state]);\n        this.setBroken();\n      }\n    }\n  }\n\n  chainTensionDown(): void {\n    const state = this.state;\n    const rivets = this.rivets;\n    const r1 = this.rivetsCalculator.getRivet(rivets, state.frb);\n    const r2 = this.rivetsCalculator.getRivet(rivets, state.rrb);\n    const d = r1.dist(r2);\n    const maxDist =\n      state.halfLinkChain * this.state.getRivetIndex(state.frb - state.rrb);\n    if (d >= maxDist) {\n      const inter = new BikeGearingCircle(r1.x, r1.y, maxDist).intersection(\n        new BikeGearingCircle(0, 0, state.rradius)\n      );\n      if (inter.intersectOccurs) {\n        let pinter: BikeGearingPoint;\n        if (inter.p1.y > 0) {\n          pinter = inter.p1 as BikeGearingPoint;\n        } else {\n          pinter = inter.p2 as BikeGearingPoint;\n        }\n        const currentRa = state.ra - state.rcb * state.rda;\n        const newRa = comparableAngle(\n          currentRa,\n          BikeGearingPoint.ZERO.getAngle(pinter)\n        );\n        if (Math.abs(newRa - currentRa) > PHYSICS_CONSTANTS.COLLISION_TOLERANCE) {\n          this.logCompute([\"fixed chain tension, da : \", newRa - currentRa]);\n          state.ra = state.ra + (newRa - currentRa);\n          this.setModified();\n        }\n      } else {\n        // broken, no intersection\n        this.logCompute([\"impossible to make chain tension\", state]);\n        this.setBroken();\n      }\n    }\n  }\n\n  fixRivet(\n    label: string,\n    ir1: number,\n    ir2: number,\n    front: boolean,\n    c: number,\n    f1: () => void,\n    f2: () => void\n  ): void {\n    const rivets = this.rivets;\n    const r1 = this.rivetsCalculator.getRivet(rivets, ir1);\n    const r2 = this.rivetsCalculator.getRivet(rivets, ir2);\n    let pm1: BikeGearingPoint, p: BikeGearingPoint, pp1: BikeGearingPoint;\n    if (front) {\n      pm1 = this.rivetsCalculator.getFrontCogPoint(c - 1);\n      p = this.rivetsCalculator.getFrontCogPoint(c);\n      pp1 = this.rivetsCalculator.getFrontCogPoint(c + 1);\n    } else {\n      pm1 = this.rivetsCalculator.getRearCogPoint(c - 1);\n      p = this.rivetsCalculator.getRearCogPoint(c);\n      pp1 = this.rivetsCalculator.getRearCogPoint(c + 1);\n    }\n\n    const ra = r1.getAngle(r2);\n    const cam1 = comparableAngle(ra, pm1.getAngle(p));\n    const cap1 = comparableAngle(ra, p.getAngle(pp1));\n    const mina = Math.min(cap1, cam1);\n    const maxa = Math.max(cap1, cam1);\n\n    if (ra < mina - PHYSICS_CONSTANTS.COLLISION_TOLERANCE) {\n      this.debugAngles(label + \" ra < mina\", mina, ra, maxa);\n      f1();\n      this.setModified();\n    } else if (ra > maxa + PHYSICS_CONSTANTS.COLLISION_TOLERANCE) {\n      this.debugAngles(label + \" ra > maxa\", mina, ra, maxa);\n      f2();\n      this.setModified();\n    }\n  }\n\n  logCompute(s: unknown[]): void {\n    if (this.state.debugCompute) {\n      console.log(s);\n    }\n  }\n\n  computeLoop(): void {\n    const state = this.state;\n    let stepIterations = 0;\n    let overflow = false;\n    this.rivets = this.rivetsCalculator.getRivets();\n    do {\n      this.iterations++;\n      stepIterations++;\n      this.modified = false;\n      if (stepIterations >= PHYSICS_CONSTANTS.MAX_ITERATIONS) {\n        console.warn(\n          `Physics computation overflow after ${PHYSICS_CONSTANTS.MAX_ITERATIONS} iterations`\n        );\n        overflow = true;\n      }\n      this.checkState();\n      if (state.rotationSpeed > 0) {\n        this.chainTensionUp();\n      } else {\n        this.chainTensionDown();\n      }\n      this.fixRivet(\n        \"front up\",\n        state.fru,\n        state.fru + 1,\n        true,\n        state.fcu,\n        () => {\n          state.fcu += 1;\n          state.fru += 1;\n        },\n        () => {\n          state.fcu -= 1;\n          state.fru -= 1;\n        }\n      );\n      this.fixRivet(\n        \"front bottom\",\n        state.frb - 1,\n        state.frb,\n        true,\n        state.fcb,\n        () => {\n          state.fcb += 1;\n          state.frb += 1;\n        },\n        () => {\n          state.fcb -= 1;\n          state.frb -= 1;\n        }\n      );\n      this.fixRivet(\n        \"rear bottom\",\n        state.rrb,\n        state.rrb + 1,\n        false,\n        state.rcb,\n        () => {\n          state.rcb += 1;\n          state.rrb += 1;\n        },\n        () => {\n          state.rcb -= 1;\n          state.rrb -= 1;\n        }\n      );\n      this.fixRivet(\n        \"rear up\",\n        state.rru - 1,\n        state.rru,\n        false,\n        state.rcu,\n        () => {\n          state.rcu += 1;\n          state.rru += 1;\n        },\n        () => {\n          state.rcu -= 1;\n          state.rru -= 1;\n        }\n      );\n    } while (this.modified && !overflow);\n  }\n\n  compute(dtchrono: number): void {\n    const state = this.state;\n    const start = performance.now();\n\n    this.logCompute([\"start compute\"]);\n\n    const dt = state.simulationSpeed * (dtchrono / 1000);\n    state.t += dt;\n\n    const rpa = state.ra;\n\n    const fda = dt * ((state.rotationSpeed * TWO_PI) / 60.0);\n    const fra = state.fa + fda;\n\n    this.onceModified = false;\n    this.modified = false;\n    this.broken = false;\n    this.iterations = 0;\n\n    let forced = false;\n    if (dtchrono === 0) {\n      forced = true;\n    }\n    while (\n      !this.broken &&\n      (Math.abs(state.fa - fra) > PHYSICS_CONSTANTS.ANGLE_TOLERANCE || forced)\n    ) {\n      if (fda > 0) {\n        state.fa = state.fa + PHYSICS_CONSTANTS.ANGLE_STEP;\n        if (state.fa > fra) {\n          state.fa = fra;\n        }\n      } else {\n        state.fa = state.fa - PHYSICS_CONSTANTS.ANGLE_STEP;\n        if (state.fa < fra) {\n          state.fa = fra;\n        }\n      }\n      this.computeLoop();\n      forced = false;\n    }\n    this.moduloState();\n\n    const rda = comparableAngle(0, state.ra - rpa);\n\n    const distchronokm = (2100 / (1000 * 1000)) * (rda / TWO_PI);\n    const dtchronoh = dtchrono / (1000 * 3600);\n    const speedkmh = distchronokm / dtchronoh;\n\n    state.speedkmh = speedkmh;\n\n    const rotation = fda / TWO_PI;\n    const dtchronomin = dtchrono / (1000 * 60);\n    const rpm = rotation / dtchronomin;\n\n    state.rpm = rpm;\n\n    const computeDuration = performance.now() - start;\n    state.computeLog =\n      this.onceModified +\n      \" \" +\n      this.iterations +\n      \" \" +\n      roundHuman(computeDuration, 1) +\n      \"ms\";\n    this.logCompute([\"end compute\"]);\n  }\n}\n","import { BikeGearingPoint } from \"./math.js\";\nimport BikeGearingState from \"./state.js\";\nimport type { Ctx2D } from \"./types.js\";\n\nconst aup = (70 * Math.PI) / 180;\nconst am = Math.PI - (60 * Math.PI) / 180;\n\nclass BikeGearingCogs {\n  /** Number of cogs */\n  n: number;\n  /** Radius */\n  r: number;\n  /** Cogs angle */\n  a: number;\n  /** Angle between two cogs */\n  da: number;\n\n  constructor(n: number, r: number, a: number, da: number) {\n    this.n = n;\n    this.r = r;\n    this.a = a;\n    this.da = da;\n  }\n}\n\nexport default class BikeGearingCogsDrawer {\n  ctx: Ctx2D;\n  state: BikeGearingState;\n\n  constructor(ctx: Ctx2D, state: BikeGearingState) {\n    this.ctx = ctx;\n    this.state = state;\n  }\n\n  drawCog(cogs: BikeGearingCogs, i: number): void {\n    const ctx = this.ctx;\n    // https://www.geogebra.org/geometry/xdgnvmz3\n    // rear_tooth_2.png\n    ctx.save();\n\n    ctx.rotate(cogs.a - i * cogs.da);\n\n    const c1 = BikeGearingPoint.getArcEnd(cogs.r + 2, cogs.da / 2);\n    const c2 = BikeGearingPoint.getArcEnd(cogs.r + 2, -cogs.da / 2);\n    const a = cogs.da / 2;\n\n    ctx.arc(c1.x, c1.y, 1.6, a, a - aup, true);\n    ctx.arc(cogs.r, 0, 3.7, am, -am);\n    ctx.arc(c2.x, c2.y, 1.6, aup - a, -a, true);\n\n    ctx.restore();\n  }\n\n  drawCogDebug(cogs: BikeGearingCogs, i: number): void {\n    const ctx = this.ctx;\n\n    ctx.save();\n    ctx.rotate(cogs.a - i * cogs.da);\n    ctx.fillText(\"\" + i, cogs.r + 10, 0);\n    ctx.beginPath();\n    ctx.lineTo(cogs.r, 0);\n    const cog2 = BikeGearingPoint.getArcEnd(cogs.r, cogs.da);\n    ctx.lineTo(cog2.x, cog2.y);\n    ctx.stroke();\n    ctx.closePath();\n    ctx.restore();\n  }\n\n  drawCogsLabel(cogs: BikeGearingCogs): void {\n    const ctx = this.ctx;\n    ctx.save();\n    ctx.rotate(cogs.a);\n    ctx.translate(cogs.r - 10, 0);\n    ctx.rotate(Math.PI / 2);\n\n    ctx.font = \"10px serif\";\n    ctx.lineWidth = 0.5;\n    ctx.strokeStyle = \"#000\";\n    ctx.strokeText(String(cogs.n), 0, 0);\n    ctx.restore();\n  }\n\n  drawCogsInternal(cogs: BikeGearingCogs): void {\n    const ctx = this.ctx;\n    const debug = this.state.debug;\n\n    ctx.fillStyle = \"#ddd\";\n    ctx.strokeStyle = \"#000\";\n\n    ctx.beginPath();\n    for (let i = 0; i < cogs.n; i++) {\n      this.drawCog(cogs, i);\n    }\n    ctx.stroke();\n    if (!debug) {\n      ctx.fill();\n    }\n    ctx.closePath();\n    if (debug) {\n      ctx.save();\n      ctx.fillStyle = \"#055\";\n      ctx.strokeStyle = \"#055\";\n      ctx.lineWidth = 0.1;\n      for (let i = 0; i < cogs.n; i++) {\n        this.drawCogDebug(cogs, i);\n      }\n      ctx.restore();\n    }\n\n    this.drawCogsLabel(cogs);\n  }\n\n  drawFrontCogs(): void {\n    const state = this.state;\n    const ctx = this.ctx;\n    ctx.save();\n    ctx.translate(state.cs, 0);\n    this.drawCogsInternal(\n      new BikeGearingCogs(state.f, state.fradius, state.fa, state.fda)\n    );\n    ctx.restore();\n  }\n\n  drawRearCogs(): void {\n    const state = this.state;\n    this.drawCogsInternal(\n      new BikeGearingCogs(state.r, state.rradius, state.ra, state.rda)\n    );\n  }\n\n  drawCogs(): void {\n    this.drawFrontCogs();\n    this.drawRearCogs();\n  }\n}\n","import { HALF_LINK } from \"./constants.js\";\nimport BikeGearingState from \"./state.js\";\nimport { BikeGearingPoint } from \"./math.js\";\nimport type { Ctx2D } from \"./types.js\";\n\n// Forward reference for BikeGearingDrawer to avoid circular dependency\ninterface DrawerInterface {\n  drawCircle(x: number, y: number, r: number, fill?: boolean): void;\n}\n\nexport default class BikeGearingRivetsDrawer {\n  ctx: Ctx2D;\n  state: BikeGearingState;\n  drawer: DrawerInterface;\n\n  constructor(ctx: Ctx2D, state: BikeGearingState, drawer: DrawerInterface) {\n    this.ctx = ctx;\n    this.state = state;\n    this.drawer = drawer;\n  }\n\n  drawRawRivet(): void {\n    const ctx = this.ctx;\n    const r = 5;\n    const dcx1 = HALF_LINK / 8;\n    const dcx2 = HALF_LINK / 4;\n    const dy = 1;\n    ctx.arc(0, 0, r, Math.PI / 2, (3 * Math.PI) / 2);\n    ctx.bezierCurveTo(\n      dcx1,\n      -r,\n      HALF_LINK / 2 - dcx2,\n      -r + dy,\n      HALF_LINK / 2,\n      -r + dy\n    );\n    ctx.bezierCurveTo(\n      HALF_LINK / 2 + dcx2,\n      -r + dy,\n      HALF_LINK - dcx1,\n      -r,\n      HALF_LINK,\n      -r\n    );\n    ctx.arc(HALF_LINK, 0, r, -Math.PI / 2, Math.PI / 2);\n    ctx.bezierCurveTo(\n      HALF_LINK - dcx1,\n      r,\n      HALF_LINK / 2 + dcx2,\n      r - dy,\n      HALF_LINK / 2,\n      r - dy\n    );\n    ctx.bezierCurveTo(HALF_LINK / 2 - dcx2, r - dy, dcx1, r, 0, r);\n  }\n\n  drawLink(r1: BikeGearingPoint, r2: BikeGearingPoint, i: number): void {\n    const debug = this.state.debug;\n    const ctx = this.ctx;\n    const d = r1.dist(r2);\n\n    ctx.save();\n    ctx.translate(r1.x, r1.y);\n    const a = r1.getAngle(r2);\n    ctx.rotate(a);\n\n    let stretch = 0;\n    if (d < HALF_LINK) {\n      stretch = (d - HALF_LINK) / d;\n    } else if (d > this.state.halfLinkChain) {\n      stretch = (d - this.state.halfLinkChain) / d;\n    }\n\n    if (debug) {\n      ctx.lineWidth = 0.1;\n      ctx.fillStyle = \"#000\";\n      const perc = Math.round(stretch * 1000);\n      ctx.fillText(i + \" \" + perc, 0, 5);\n      this.drawer.drawCircle(0, 0, 3.7);\n\n      ctx.save();\n      if (stretch > 0.0001) {\n        stretch = Math.max(0.025, stretch);\n      }\n      if (stretch < -0.0001) {\n        stretch = Math.min(-0.025, stretch);\n      }\n      const h =\n        120 - Math.max(-120, Math.min(120, Math.round((120 * stretch) / 0.05)));\n      ctx.strokeStyle = \"hsla(\" + h + \", 100%, 50%, 1)\";\n\n      ctx.beginPath();\n      let dy = 0;\n      if (i % 2 === 1) {\n        dy = 1;\n      } else {\n        dy = -1;\n      }\n      ctx.moveTo((d - HALF_LINK) / 2, dy);\n      ctx.lineTo((d - HALF_LINK) / 2, 0);\n      ctx.lineTo(d - (d - HALF_LINK) / 2, 0);\n      ctx.lineTo(d - (d - HALF_LINK) / 2, dy);\n      ctx.stroke();\n      ctx.closePath();\n\n      ctx.restore();\n    }\n\n    ctx.translate((d - HALF_LINK) / 2, 0);\n\n    const astretch = Math.abs(stretch);\n    if (astretch > 0.0001) {\n      const s = Math.max(50, Math.min(100, Math.round((100 * stretch) / 0.05)));\n      ctx.fillStyle = \"hsla(0, \" + s + \"%, 87%, 1)\";\n    } else {\n      ctx.fillStyle = \"hsla(0, 0%, 87%, 1)\";\n    }\n\n    ctx.beginPath();\n    this.drawRawRivet();\n    if (!debug) {\n      ctx.fill();\n    }\n    ctx.stroke();\n    ctx.closePath();\n\n    if (!debug && i % 2 === 1) {\n      ctx.fillStyle = \"#ccc\";\n      this.drawer.drawCircle(0, 0, 2, true);\n      this.drawer.drawCircle(d, 0, 2, true);\n    }\n    if (i % 10 === 1) {\n      ctx.save();\n      ctx.font = \"3.5px serif\";\n      ctx.lineWidth = 0.1;\n      ctx.strokeStyle = \"#000\";\n      ctx.strokeText(\"GLA\", d / 2, 0.4);\n      ctx.restore();\n    }\n\n    ctx.restore();\n  }\n\n  drawLinks(rivets: BikeGearingPoint[]): void {\n    for (let i = 0; i < rivets.length - 1; i = i + 2) {\n      this.drawLink(rivets[i], rivets[i + 1], i);\n    }\n    this.drawLink(rivets[rivets.length - 1], rivets[0], rivets.length - 1);\n    for (let i = 1; i < rivets.length - 1; i = i + 2) {\n      this.drawLink(rivets[i], rivets[i + 1], i);\n    }\n  }\n}\n","import { TWO_PI } from \"./constants.js\";\nimport { BikeGearingPoint } from \"./math.js\";\nimport BikeGearingState from \"./state.js\";\nimport type { Ctx2D, WheelDimensions } from \"./types.js\";\n\n// Forward reference for BikeGearingDrawer to avoid circular dependency\ninterface DrawerInterface {\n  drawCircle(x: number, y: number, r: number, fill?: boolean): void;\n}\n\nexport default class BikeGearingWheelDrawer {\n  ctx: Ctx2D;\n  state: BikeGearingState;\n  drawer: DrawerInterface;\n  wheel: WheelDimensions;\n\n  constructor(ctx: Ctx2D, state: BikeGearingState, drawer: DrawerInterface) {\n    this.ctx = ctx;\n    this.state = state;\n    this.drawer = drawer;\n    this.wheel = {\n      total: (622 + 2 * 23) / 2,\n      rim: 622 / 2,\n      brakeHeight: 11,\n      rimHeight: 32,\n      hub: 90 / 2,\n      hubSpoke: 84 / 2,\n    };\n  }\n\n  drawWheelCircle(d: number, c: string): void {\n    const ctx = this.ctx;\n    ctx.save();\n    ctx.fillStyle = c;\n    ctx.strokeStyle = \"#000\";\n    this.drawer.drawCircle(0, 0, d, true);\n    ctx.restore();\n  }\n\n  drawValveRect(w: number, h: number, dx: number): void {\n    const debug = this.state.debug;\n    const ctx = this.ctx;\n    ctx.beginPath();\n    ctx.moveTo(dx, h / 2);\n    ctx.lineTo(dx + w, h / 2);\n    ctx.lineTo(dx + w, -h / 2);\n    ctx.lineTo(dx, -h / 2);\n    ctx.lineTo(dx, h / 2);\n    if (!debug) {\n      ctx.fill();\n    }\n    ctx.stroke();\n    ctx.closePath();\n  }\n\n  drawValve(): void {\n    const ctx = this.ctx;\n    const wheel = this.wheel;\n    ctx.save();\n\n    ctx.translate(wheel.rim - wheel.rimHeight, 0);\n    ctx.rotate(Math.PI);\n\n    ctx.lineWidth = 0.1;\n    ctx.strokeStyle = \"#000\";\n\n    ctx.fillStyle = \"#ad8052\";\n    this.drawValveRect(22, 6, 0);\n    this.drawValveRect(5, 5, 22);\n    ctx.fillStyle = \"#aaa\";\n    this.drawValveRect(5, 4, 27);\n    ctx.fillStyle = \"#ad8052\";\n    this.drawValveRect(3, 2, 32);\n\n    ctx.restore();\n  }\n\n  drawLogo(\n    textRadius: number,\n    color: string,\n    text: string,\n    rotation: number\n  ): void {\n    const ctx = this.ctx;\n    ctx.save();\n\n    ctx.textBaseline = \"bottom\";\n    ctx.textAlign = \"left\";\n\n    ctx.rotate(rotation);\n    ctx.fillStyle = color;\n    ctx.font = \"bold 12px serif\";\n    let currentString = \"\";\n    const totd = ctx.measureText(text).width;\n    const baseAngle = -totd / 2 / textRadius;\n    for (let i = 0; i < text.length; i++) {\n      const char = text.charAt(i);\n\n      ctx.save();\n\n      const d = ctx.measureText(currentString).width;\n\n      ctx.rotate(baseAngle + d / textRadius);\n      ctx.translate(textRadius, 0);\n      ctx.rotate(Math.PI / 2);\n\n      ctx.lineWidth = 0.5;\n      ctx.fillText(char, 0, 0);\n\n      ctx.restore();\n      currentString = currentString + char;\n    }\n    ctx.restore();\n  }\n\n  drawNipples(): void {\n    const ctx = this.ctx;\n    const wheel = this.wheel;\n    ctx.save();\n    ctx.rotate(TWO_PI / (24 * 2));\n    ctx.strokeStyle = \"#000\";\n    ctx.fillStyle = \"#999\";\n    for (let i = 0; i < 24; i++) {\n      ctx.save();\n      ctx.rotate((i * TWO_PI) / 24);\n      ctx.translate(wheel.rim - wheel.rimHeight, 0);\n      ctx.rotate(Math.PI);\n      this.drawValveRect(9, 3, 0);\n      ctx.restore();\n    }\n    ctx.restore();\n  }\n\n  drawSpokes(behindHub: boolean): void {\n    const ctx = this.ctx;\n    const wheel = this.wheel;\n    for (let i = 0; i < 24; i++) {\n      if (!behindHub && i % 4 === 2) {\n        ctx.save();\n        ctx.lineWidth = 0.1;\n        ctx.strokeStyle = \"#000\";\n        ctx.fillStyle = \"#444\";\n        ctx.rotate((i * TWO_PI) / 24);\n        this.drawer.drawCircle(wheel.hubSpoke, 0, 2, true);\n        ctx.restore();\n      }\n      if (!behindHub && i % 4 === 0) {\n        ctx.save();\n        ctx.lineWidth = 0.1;\n        ctx.strokeStyle = \"#000\";\n        ctx.fillStyle = \"#ddd\";\n        ctx.rotate((i * TWO_PI) / 24);\n        this.drawer.drawCircle(wheel.hubSpoke, 0, 1.5, true);\n        ctx.restore();\n      }\n      if ((behindHub && i % 4 !== 0) || (!behindHub && i % 4 === 0)) {\n        ctx.save();\n\n        ctx.lineCap = \"round\";\n        ctx.strokeStyle = \"#000\";\n        ctx.lineWidth = 2;\n\n        ctx.rotate((i * TWO_PI) / 24);\n        let a: number;\n        if (i % 2 === 0) {\n          a = (3.5 * TWO_PI) / 24;\n        } else {\n          a = (-2.5 * TWO_PI) / 24;\n        }\n\n        ctx.beginPath();\n        ctx.moveTo(wheel.hubSpoke, 0);\n        const e = BikeGearingPoint.getArcEnd(wheel.rim - wheel.rimHeight - 9, a);\n        ctx.lineTo(e.x, e.y);\n\n        ctx.stroke();\n        ctx.closePath();\n\n        ctx.restore();\n      }\n    }\n  }\n\n  drawWheel(): void {\n    const ctx = this.ctx;\n    const wheel = this.wheel;\n\n    ctx.save();\n    ctx.rotate(this.state.ra);\n\n    this.drawWheelCircle(wheel.total, \"#555\");\n    this.drawWheelCircle(wheel.rim, \"#eee\");\n    this.drawWheelCircle(wheel.rim - wheel.brakeHeight, \"#ddd\");\n    this.drawWheelCircle(wheel.rim - wheel.rimHeight, \"#fff\");\n\n    this.drawSpokes(true);\n    this.drawWheelCircle(wheel.hub, \"#eee\");\n    this.drawSpokes(false);\n\n    this.drawNipples();\n    this.drawValve();\n    this.drawLogo(wheel.rim + 4, \"#fff\", \"N-Peloton\", 0);\n    this.drawLogo(\n      wheel.rim + 4,\n      \"#fff\",\n      \"My drinking team has a cycling problem\",\n      Math.PI\n    );\n\n    this.drawLogo(\n      wheel.rim - wheel.rimHeight + 2,\n      \"#000\",\n      \"Fonderies\",\n      Math.PI / 2\n    );\n    this.drawLogo(\n      wheel.rim - wheel.rimHeight + 2,\n      \"#000\",\n      \"Mercredi 20h30\",\n      -Math.PI / 2\n    );\n\n    ctx.restore();\n  }\n}\n","import BikeGearingCogsDrawer from \"./cogs_drawer.js\";\nimport BikeGearingRivetsDrawer from \"./rivet_drawer.js\";\nimport BikeGearingWheelDrawer from \"./wheel_drawer.js\";\nimport { roundHuman, toDegreesHuman } from \"./math.js\";\nimport { TWO_PI } from \"./constants.js\";\nimport BikeGearingState from \"./state.js\";\nimport BikeGearingRivetsCalculator from \"./rivet_calculator.js\";\nimport BikeGearingInteractive from \"./interactive.js\";\nimport type { Ctx2D } from \"./types.js\";\n\nexport default class BikeGearingDrawer {\n  canvas: HTMLCanvasElement;\n  ctx: Ctx2D;\n  state: BikeGearingState;\n  rivetsCalculator: BikeGearingRivetsCalculator;\n  interactive: BikeGearingInteractive;\n  cogsDrawer: BikeGearingCogsDrawer;\n  rivetsDrawer: BikeGearingRivetsDrawer;\n  wheelDrawer: BikeGearingWheelDrawer;\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    ctx: Ctx2D,\n    state: BikeGearingState,\n    rivetsCalculator: BikeGearingRivetsCalculator,\n    interactive: BikeGearingInteractive\n  ) {\n    this.canvas = canvas;\n    this.ctx = ctx;\n    this.state = state;\n    this.rivetsCalculator = rivetsCalculator;\n    this.interactive = interactive;\n    this.cogsDrawer = new BikeGearingCogsDrawer(ctx, state);\n    this.rivetsDrawer = new BikeGearingRivetsDrawer(ctx, state, this);\n    this.wheelDrawer = new BikeGearingWheelDrawer(ctx, state, this);\n  }\n\n  drawCircle(x: number, y: number, r: number, fill: boolean = false): void {\n    const ctx = this.ctx;\n    const debug = this.state.debug;\n    ctx.beginPath();\n    ctx.arc(x, y, r, 0, TWO_PI);\n    if (fill && !debug) {\n      ctx.fill();\n    }\n    ctx.stroke();\n    ctx.closePath();\n  }\n\n  printStateValues(values: string[]): void {\n    const ctx = this.ctx;\n\n    ctx.save();\n    ctx.font = \"16px serif\";\n    ctx.fillStyle = \"rgba(255,255,255,0.7)\";\n    let maxWidth = 0;\n    for (let i = 0; i < values.length; i++) {\n      maxWidth = Math.max(maxWidth, ctx.measureText(values[i]).width);\n    }\n    const x = this.canvas.width - maxWidth - 10;\n    ctx.fillRect(x, 4, maxWidth, 17 * values.length);\n    ctx.fillStyle = \"#000\";\n    for (let i = 0; i < values.length; i++) {\n      ctx.fillText(values[i], x, 20 + 17 * i);\n    }\n    ctx.restore();\n  }\n\n  getCommonValues(): string[] {\n    const state = this.state;\n    return [\n      \"Single-legged skid patches: \" + state.skidPatchesSingleLegged,\n      \"Ambidextrous skid patches: \" + state.skidPatchesAmbidextrous,\n      \"Speed (km/h): \" + roundHuman(state.speedkmh, 1),\n      \"RPM: \" + roundHuman(state.rpm, 1) + \"rpm\",\n      \"\",\n      \"FPS: \" + roundHuman(state.fps, 0),\n    ];\n  }\n\n  getDebugValues(): string[] {\n    const values = this.getCommonValues();\n    const state = this.state;\n    const debugValues = [\n      \"\",\n      \"t: \" + roundHuman(state.t, 5),\n      \"fa: \" + toDegreesHuman(state.fa) + \"\\u00B0\",\n      \"fcu: \" + state.fcu,\n      \"fru: \" + state.fru,\n      \"fcb: \" + state.fcb,\n      \"frb: \" + state.frb,\n      \"ra: \" + toDegreesHuman(state.ra) + \"\\u00B0\",\n      \"rcu: \" + state.rcu,\n      \"rru: \" + state.rru,\n      \"rcb: \" + state.rcb,\n      \"rrb: \" + state.rrb,\n      \"computeLog: \" + state.computeLog,\n      \"Last draw: \" + roundHuman(state.drawDuration, 2) + \"ms\",\n      \"cameraOffset.x: \" + roundHuman(this.interactive.cameraOffset.x, 2),\n      \"cameraOffset.y: \" + roundHuman(this.interactive.cameraOffset.y, 2),\n      \"cameraZoom: \" + roundHuman(this.interactive.cameraZoom, 2),\n      \"worldWidth: \" + roundHuman(this.interactive.worldWidth, 2),\n    ];\n    values.push(...debugValues);\n    return values;\n  }\n\n  draw(): void {\n    const ctx = this.ctx;\n    const state = this.state;\n    const debug = state.debug;\n    const paused = state.paused;\n\n    const start = performance.now();\n    ctx.save();\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    if (debug || paused) {\n      ctx.fillStyle = \"rgba(255,255,255,1.0)\";\n    } else {\n      ctx.fillStyle = \"rgba(255,255,255,0.7)\";\n    }\n    ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n    ctx.restore();\n\n    ctx.save();\n    ctx.font = \"5px serif\";\n    ctx.textBaseline = \"middle\";\n    ctx.textAlign = \"center\";\n\n    ctx.lineWidth = 0.3;\n\n    ctx.translate(\n      this.interactive.cameraOffset.x,\n      this.interactive.cameraOffset.y\n    );\n    ctx.scale(this.interactive.cameraZoom, this.interactive.cameraZoom);\n\n    const rivets = this.rivetsCalculator.getRivets();\n    let r1, r2;\n    if (state.followRivet) {\n      r1 = this.rivetsCalculator.getRivet(rivets, 0);\n      r2 = this.rivetsCalculator.getRivet(rivets, 1);\n      if (r1 && r2) {\n        const rivetAngle = r1.getAngle(r2);\n        ctx.rotate(Math.PI - rivetAngle);\n        ctx.translate(-r1.x, -r1.y);\n      }\n    }\n\n    if (state.doDrawWheel) {\n      this.wheelDrawer.drawWheel();\n    }\n    this.cogsDrawer.drawCogs();\n    this.rivetsDrawer.drawLinks(rivets);\n\n    if (state.followRivet) {\n      if (r1) {\n        ctx.beginPath();\n        ctx.lineTo(r1.x - 5, r1.y);\n        ctx.lineTo(r1.x + 5, r1.y);\n        ctx.stroke();\n        ctx.closePath();\n        ctx.beginPath();\n        ctx.lineTo(r1.x, r1.y + 5);\n        ctx.lineTo(r1.x, r1.y - 5);\n        ctx.stroke();\n        ctx.closePath();\n      }\n    }\n\n    ctx.restore();\n\n    if (debug) {\n      this.printStateValues(this.getDebugValues());\n    } else {\n      this.printStateValues(this.getCommonValues());\n    }\n    state.drawDuration = performance.now() - start;\n  }\n}\n","import BikeGearingInteractive from \"./interactive.js\";\nimport BikeGearingRivetsCalculator from \"./rivet_calculator.js\";\nimport BikeGearingComputer from \"./computer.js\";\nimport BikeGearingDrawer from \"./drawer.js\";\nimport BikeGearingState from \"./state.js\";\nimport type { Ctx2D } from \"./types.js\";\n\nexport default class BikeGearingMain {\n  canvas: HTMLCanvasElement;\n  interactive: BikeGearingInteractive;\n  state: BikeGearingState;\n  computer: BikeGearingComputer;\n  drawer: BikeGearingDrawer;\n  onReset: () => void;\n  previousChrono: number = 0;\n\n  constructor(state: BikeGearingState, canvasId: string, onReset: () => void) {\n    const canvas = document.getElementById(canvasId);\n    if (!canvas || !(canvas instanceof HTMLCanvasElement)) {\n      throw new Error(`Canvas element with id '${canvasId}' not found`);\n    }\n    this.canvas = canvas;\n\n    const ctx = this.canvas.getContext(\"2d\") as Ctx2D | null;\n    if (!ctx) {\n      throw new Error(\"Failed to get 2D rendering context\");\n    }\n\n    this.interactive = new BikeGearingInteractive(this.canvas, this);\n    this.interactive.initInteractive();\n\n    this.state = state;\n\n    const rivetsCalculator = new BikeGearingRivetsCalculator(this.state);\n\n    this.computer = new BikeGearingComputer(this.state, rivetsCalculator);\n    this.drawer = new BikeGearingDrawer(\n      this.canvas,\n      ctx,\n      this.state,\n      rivetsCalculator,\n      this.interactive\n    );\n\n    this.onReset = onReset;\n  }\n\n  start(): void {\n    this.previousChrono = 0;\n    this.resetState();\n    requestAnimationFrame((chrono) => this.frame(chrono));\n  }\n\n  frame(chrono: number): void {\n    if (this.previousChrono === undefined) {\n      this.previousChrono = chrono;\n    }\n    if (!this.state.paused) {\n      let dchrono = Math.max(1, chrono - this.previousChrono);\n      this.state.fps = 1000 / dchrono;\n      if (dchrono > 100) {\n        dchrono = 16;\n      }\n      try {\n        this.computer.compute(dchrono);\n      } catch (e) {\n        console.error(\"Physics computation error:\", e);\n        this.computer.reset();\n        this.state.paused = true;\n      }\n      this.drawer.draw();\n    } else {\n      this.state.fps = 0;\n    }\n    this.previousChrono = chrono;\n    requestAnimationFrame((chrono) => this.frame(chrono));\n  }\n\n  resetState(): void {\n    this.state.reset();\n    this.reset();\n  }\n\n  resetComputer(): void {\n    this.computer.reset();\n    this.computer.compute(0);\n  }\n\n  reset(): void {\n    this.resetComputer();\n    this.onReset();\n    this.interactive.reset();\n  }\n\n  drawIfPaused(): void {\n    if (this.state.paused) {\n      this.drawer.draw();\n    }\n  }\n\n  compute0(): void {\n    this.computer.moduloState();\n    this.computer.compute(0);\n    this.drawer.draw();\n  }\n}\n","export class BikeGearingInputRange {\n  inputElement: HTMLInputElement;\n  spanElement: HTMLElement | null;\n  toHuman: (v: string) => string;\n  valueSetter: (v: number) => void;\n  valueGetter: () => number;\n  valueFromInput: (v: number) => number;\n  valueToInput: (v: number) => number;\n\n  constructor(\n    id: string,\n    toHuman: (v: string) => string,\n    valueGetter: () => number,\n    valueSetter: (v: number) => void,\n    valueFromInput: (v: number) => number = (v) => v,\n    valueToInput: (v: number) => number = (v) => v\n  ) {\n    const inputEl = document.getElementById(id);\n    if (!inputEl || !(inputEl instanceof HTMLInputElement)) {\n      throw new Error(`Input element with id '${id}' not found`);\n    }\n    this.inputElement = inputEl;\n    this.spanElement = document.getElementById(id + \"Value\");\n    this.toHuman = toHuman;\n    this.valueSetter = valueSetter;\n    this.valueGetter = valueGetter;\n    this.valueFromInput = valueFromInput;\n    this.valueToInput = valueToInput;\n\n    this.inputElement.addEventListener(\"input\", (e) => this.onInput(e));\n  }\n\n  onInput(e: Event): void {\n    try {\n      const target = e.target as HTMLInputElement;\n      const inputValue = parseFloat(target.value);\n      if (!isNaN(inputValue)) {\n        this.valueSetter(this.valueFromInput(inputValue));\n        this.setTextValue();\n      }\n    } catch (error) {\n      console.error(\"Input validation error:\", error);\n    }\n  }\n\n  setInputValue(): void {\n    this.inputElement.value = String(this.valueToInput(this.valueGetter()));\n  }\n\n  setTextValue(): void {\n    if (this.spanElement) {\n      try {\n        this.spanElement.innerText = this.toHuman(this.inputElement.value);\n      } catch (error) {\n        console.error(\"Text display error:\", error);\n        this.spanElement.innerText = \"Error\";\n      }\n    }\n  }\n\n  reset(): void {\n    this.setInputValue();\n    this.setTextValue();\n  }\n}\n\nexport class BikeGearingInputCheckbox {\n  inputElement: HTMLInputElement;\n  valueSetter: (v: boolean) => void;\n  valueGetter: () => boolean;\n\n  constructor(\n    id: string,\n    valueGetter: () => boolean,\n    valueSetter: (v: boolean) => void\n  ) {\n    const inputEl = document.getElementById(id);\n    if (!inputEl || !(inputEl instanceof HTMLInputElement)) {\n      throw new Error(`Checkbox element with id '${id}' not found`);\n    }\n    this.inputElement = inputEl;\n    this.valueSetter = valueSetter;\n    this.valueGetter = valueGetter;\n\n    this.inputElement.addEventListener(\"change\", (e) => {\n      const target = e.target as HTMLInputElement;\n      this.valueSetter(target.checked);\n    });\n  }\n\n  reset(): void {\n    this.inputElement.checked = this.valueGetter();\n  }\n}\n","import { HALF_LINK } from \"./constants.js\";\nimport { computeSkidPatches } from \"./math.js\";\nimport type {\n  FinderInputs,\n  ValidCog,\n  ChainringCombo,\n  ChainringsCombo,\n} from \"./types.js\";\n\n/**\n * Calculate required chainstay length for given chainring, cog, and chain length\n * Uses quadratic formula to solve for optimal chainstay distance\n */\nexport function calculateChainstay(\n  f: number,\n  r: number,\n  cl: number,\n  chainWear: number\n): number | null {\n  const effectiveHalfLink = HALF_LINK * (1 + chainWear);\n\n  // Total chain length\n  const L = cl * effectiveHalfLink;\n\n  // Primitive radii\n  const R = (f * effectiveHalfLink) / (2 * Math.PI);\n  const r_small = (r * effectiveHalfLink) / (2 * Math.PI);\n\n  // Quadratic equation: aD² + bD + c = 0\n  const a = 2;\n  const b = Math.PI * (R + r_small) - L;\n  const c = Math.pow(R - r_small, 2);\n\n  // Calculate discriminant\n  const discriminant = b * b - 4 * a * c;\n\n  if (discriminant < 0) {\n    return null; // Chain too short\n  }\n\n  // Solve for D (chainstay distance)\n  const D = (-b + Math.sqrt(discriminant)) / (2 * a);\n\n  // Subtract 0.2mm to account for chain tension/tightness.\n  // The theoretical chainstay assumes perfect geometry, but in practice\n  // a slightly shorter distance ensures proper chain tension without slack.\n  return D - 0.2;\n}\n\n/**\n * Find all valid cogs for a given chainring and chain length\n */\nexport function findAllCogs(\n  chainring: number,\n  chainLinks: number,\n  inputs: FinderInputs\n): ValidCog[] {\n  const validCogs: ValidCog[] = [];\n\n  for (let cog = inputs.cogMin; cog <= inputs.cogMax; cog++) {\n    const ratio = chainring / cog;\n    const ratioValid = ratio >= inputs.ratioMin && ratio <= inputs.ratioMax;\n\n    const chainstay = calculateChainstay(chainring, cog, chainLinks, 0);\n\n    if (chainstay === null) continue;\n    if (chainstay < inputs.csMin || chainstay > inputs.csMax) continue;\n\n    const chainstayWeared = calculateChainstay(\n      chainring,\n      cog,\n      chainLinks,\n      inputs.maxChainWear\n    );\n\n    if (chainstayWeared === null) continue;\n    if (chainstayWeared < inputs.csMin || chainstayWeared > inputs.csMax)\n      continue;\n\n    const skidPatches = computeSkidPatches(chainring, cog);\n\n    validCogs.push({\n      chainring,\n      cog,\n      ratio,\n      ratioValid,\n      chainstay,\n      chainstayWeared,\n      skidPatchesSingleLegged: skidPatches[0],\n      skidPatchesAmbidextrous: skidPatches[1],\n    });\n  }\n\n  // Sort by ratio descending (highest ratio = smallest cog first)\n  validCogs.sort((a, b) => b.ratio - a.ratio);\n\n  return validCogs;\n}\n\n// Scoring weights\nconst COVERAGE_WEIGHT = 0.35;\nconst COUNT_WEIGHT = 0.3;\nconst EVENNESS_WEIGHT = 0.2;\nconst REUSABILITY_WEIGHT = 0.15;\nconst MAX_EXPECTED_RATIOS = 15;\n\n/**\n * Calculate score for a chainring/chain combo\n * Score = coverage * (coverageWeight + countWeight * countScore + evennessWeight * evennessScore + reusabilityWeight * reusabilityScore)\n */\nexport function calculateScore(\n  chainLinks: number,\n  chainringComboList: ChainringCombo[],\n  inputs: FinderInputs\n): ChainringsCombo {\n  const allCogs = chainringComboList.flatMap((c) => c.allCogs);\n  allCogs.sort((a, b) => a.ratio - b.ratio);\n  const validCogs = allCogs.filter((c) => c.ratioValid);\n  const n = validCogs.length;\n  const chainringCount = chainringComboList.length;\n  const chainrings = chainringComboList.map(\n    (chainringCombo) => chainringCombo.chainring\n  );\n\n  // Edge case: no ratios\n  if (n === 0) {\n    return {\n      chainLinks,\n      chainrings,\n      score: 0,\n      maxGap: 0,\n      ratioCount: 0,\n      ratioCoverage: 0,\n      allCogs,\n      coverageScore: 0,\n      countScore: 0,\n      evennessScore: 0,\n      reusabilityScore: 0,\n    };\n  }\n\n  // Sort ratios ascending\n  validCogs.sort((a, b) => a.ratio - b.ratio);\n  const ratios = validCogs.map((c) => c.ratio);\n\n  const minRatio = ratios[0];\n  const maxRatio = ratios[n - 1];\n  const achievedRange = maxRatio - minRatio;\n  const targetRange = inputs.ratioMax - inputs.ratioMin;\n\n  // Calculate gaps and maxGap\n  const gaps: number[] = [];\n  let maxGap = 0;\n  for (let i = 1; i < n; i++) {\n    const gap = ratios[i] - ratios[i - 1];\n    gaps.push(gap);\n    if (gap > maxGap) {\n      maxGap = gap;\n    }\n  }\n\n  // === COVERAGE SCORE ===\n  let coverageScore: number;\n  if (n === 1) {\n    coverageScore = 0; // Single ratio cannot cover a range\n  } else if (targetRange <= 0) {\n    coverageScore = 1; // Trivially satisfied\n  } else {\n    coverageScore = Math.min(achievedRange / targetRange, 1.0);\n  }\n\n  // === COUNT SCORE (logarithmic with diminishing returns) ===\n  const countScore = Math.min(\n    Math.log(n + 1) / Math.log(MAX_EXPECTED_RATIOS + 1),\n    1.0\n  );\n\n  // === EVENNESS SCORE (normalized RMSE from ideal gap) ===\n  let evennessScore: number;\n  if (n <= 2) {\n    evennessScore = 1.0; // Trivially even (0 or 1 gap)\n  } else {\n    const idealGap = achievedRange / (n - 1);\n\n    if (idealGap <= 0) {\n      evennessScore = 1.0; // All ratios identical\n    } else {\n      let sumSquaredDev = 0;\n      for (const gap of gaps) {\n        sumSquaredDev += Math.pow(gap - idealGap, 2);\n      }\n      const rmse = Math.sqrt(sumSquaredDev / gaps.length);\n      const normalizedRmse = rmse / idealGap;\n      evennessScore = 1 / (1 + normalizedRmse);\n    }\n  }\n\n  // === REUSABILITY SCORE (cog reuse across chainrings) ===\n  let reusabilityScore: number;\n  if (chainringCount <= 1) {\n    reusabilityScore = 0; // No reusability possible with single chainring\n  } else {\n    // Count unique cogs\n    const uniqueCogs = new Set(validCogs.map((c) => c.cog)).size;\n    const totalUsages = n;\n\n    // reusabilityScore = (totalUsages - uniqueCogs) / (uniqueCogs * (chainringCount - 1))\n    // This ranges from 0 (no reuse) to 1 (perfect reuse: every cog works with every chainring)\n    const maxReuse = uniqueCogs * (chainringCount - 1);\n    if (maxReuse <= 0) {\n      reusabilityScore = 0;\n    } else {\n      reusabilityScore = Math.min((totalUsages - uniqueCogs) / maxReuse, 1.0);\n    }\n  }\n\n  // === FINAL SCORE ===\n  const score =\n    coverageScore *\n    (COVERAGE_WEIGHT +\n      COUNT_WEIGHT * countScore +\n      EVENNESS_WEIGHT * evennessScore +\n      REUSABILITY_WEIGHT * reusabilityScore);\n\n  return {\n    chainLinks,\n    chainrings,\n    score,\n    ratioCount: n,\n    ratioCoverage: coverageScore,\n    maxGap,\n    allCogs,\n    coverageScore,\n    countScore,\n    evennessScore,\n    reusabilityScore,\n  };\n}\n\nfunction combinations<T>(arr: T[], n: number): T[][] {\n  let result: T[][] = [];\n  for (let i = 1; i <= n; i++) {\n    result = result.concat(combinationsStrict(arr, i));\n  }\n  return result;\n}\n\nfunction combinationsStrict<T>(arr: T[], n: number): T[][] {\n  if (n === 0) return [[]];\n  if (n > arr.length) return [];\n\n  const result: T[][] = [];\n\n  function helper(start: number, combo: T[]) {\n    if (combo.length === n) {\n      result.push([...combo]);\n      return;\n    }\n\n    for (let i = start; i < arr.length; i++) {\n      combo.push(arr[i]);\n      helper(i + 1, combo);\n      combo.pop();\n    }\n  }\n\n  helper(0, []);\n  return result;\n}\n\n/**\n * Main finder function - find all chainring/chain combinations\n */\nexport function findChainringCombos(inputs: FinderInputs): ChainringsCombo[] {\n  const results: ChainringsCombo[] = [];\n\n  // Determine chain link iteration based on half-link option\n  const startLinks = inputs.allowHalfLink\n    ? inputs.chainLinksMin\n    : inputs.chainLinksMin % 2 === 0\n    ? inputs.chainLinksMin\n    : inputs.chainLinksMin + 1;\n\n  const linkStep = inputs.allowHalfLink ? 1 : 2;\n\n  for (\n    let chainLinks = startLinks;\n    chainLinks <= inputs.chainLinksMax;\n    chainLinks += linkStep\n  ) {\n    const chainrings: ChainringCombo[] = [];\n\n    for (\n      let chainring = inputs.chainringMin;\n      chainring <= inputs.chainringMax;\n      chainring++\n    ) {\n      const allCogs = findAllCogs(chainring, chainLinks, inputs);\n\n      if (allCogs.filter((c) => c.ratioValid).length === 0) continue;\n\n      // Only include if at least one ratio is in target range\n      chainrings.push({\n        chainring,\n        allCogs,\n      });\n    }\n\n    if (chainrings.length > 0) {\n      const chainringComboListList = combinations(\n        chainrings,\n        inputs.chainringCount\n      );\n      for (const chainringComboList of chainringComboListList) {\n        chainringComboList.sort((a, b) => a.chainring - b.chainring);\n        results.push(calculateScore(chainLinks, chainringComboList, inputs));\n      }\n    }\n  }\n\n  // Sort by score descending\n  results.sort((a, b) => b.score - a.score);\n\n  return results;\n}\n","import { findChainringCombos } from \"./ratio_finder.js\";\nimport BikeGearingState from \"./state.js\";\nimport type {\n  FinderInputs,\n  RangeInputConfig,\n  Point,\n  ChainringsCombo,\n} from \"./types.js\";\n\n// Forward reference for BikeGearingMain to avoid circular dependency\ninterface MainInterface {\n  resetComputer(): void;\n}\n\ninterface RatioFinderInputRefs {\n  csRangeMin: HTMLInputElement;\n  csRangeMax: HTMLInputElement;\n  ratioRangeMin: HTMLInputElement;\n  ratioRangeMax: HTMLInputElement;\n  cogRangeMin: HTMLInputElement;\n  cogRangeMax: HTMLInputElement;\n  chainringRangeMin: HTMLInputElement;\n  chainringRangeMax: HTMLInputElement;\n  chainLinksRangeMin: HTMLInputElement;\n  chainLinksRangeMax: HTMLInputElement;\n  allowHalfLink: HTMLInputElement;\n  maxChainWearInput: HTMLInputElement;\n  chainringCountInput: HTMLSelectElement;\n  [key: string]: HTMLInputElement | HTMLSelectElement;\n}\n\nexport default class RatioFinderUi {\n  state: BikeGearingState;\n  main: MainInterface;\n  onUiUpdate: () => void;\n\n  modal: HTMLElement | null = null;\n  overlay: HTMLElement | null = null;\n  resultsContainer: HTMLElement | null = null;\n\n  inputConfigs: RangeInputConfig[];\n  inputs: Partial<RatioFinderInputRefs> = {};\n  lastInputs: FinderInputs | null = null;\n  expandedRows: Set<string> = new Set();\n  dragStart: Point | null = null;\n\n  // Bounds for dragging\n  modalMinLeft: number = 0;\n  modalMaxLeft: number = 0;\n  modalMinTop: number = 0;\n  modalMaxTop: number = 0;\n\n  // Bound event handlers for cleanup\n  boundMouseMove: ((e: MouseEvent | TouchEvent) => void) | null = null;\n  boundMouseUp: ((e: MouseEvent | TouchEvent) => void) | null = null;\n\n  constructor(\n    state: BikeGearingState,\n    main: MainInterface,\n    onUiUpdate: () => void\n  ) {\n    this.state = state;\n    this.main = main;\n    this.onUiUpdate = onUiUpdate;\n    this.inputConfigs = this.getInputConfigs();\n  }\n\n  getInputConfigs(): RangeInputConfig[] {\n    return [\n      {\n        id: \"csRange\",\n        label: \"Chainstay (mm)\",\n        min: 350,\n        max: 450,\n        step: 1,\n        defaultMin: 381,\n        defaultMax: 396,\n      },\n      {\n        id: \"ratioRange\",\n        label: \"Target Ratio\",\n        min: 1.5,\n        max: 5.0,\n        step: 0.1,\n        defaultMin: 2.6,\n        defaultMax: 3.4,\n      },\n      {\n        id: \"cogRange\",\n        label: \"Cog Teeth\",\n        min: 11,\n        max: 25,\n        step: 1,\n        defaultMin: 13,\n        defaultMax: 21,\n      },\n      {\n        id: \"chainringRange\",\n        label: \"Chainring Teeth\",\n        min: 28,\n        max: 70,\n        step: 1,\n        defaultMin: 46,\n        defaultMax: 55,\n      },\n      {\n        id: \"chainLinksRange\",\n        label: \"Chain Links\",\n        min: 80,\n        max: 130,\n        step: 1,\n        defaultMin: 80,\n        defaultMax: 130,\n      },\n    ];\n  }\n\n  init(): void {\n    this.createModal();\n    this.createOpenButton();\n    this.bindEvents();\n  }\n\n  createModal(): void {\n    // Create overlay\n    this.overlay = document.createElement(\"div\");\n    this.overlay.id = \"ratio-finder-overlay\";\n    this.overlay.className = \"ratio-finder-overlay\";\n\n    // Create modal\n    this.modal = document.createElement(\"div\");\n    this.modal.id = \"ratio-finder-modal\";\n    this.modal.className = \"ratio-finder-modal\";\n\n    // Modal header\n    const header = document.createElement(\"div\");\n    header.className = \"ratio-finder-header\";\n    header.innerHTML = `\n      <h2>Chainring Finder</h2>\n      <button class=\"ratio-finder-close\">&times;</button>\n    `;\n\n    // Modal content (inputs) - collapsible\n    const inputsSection = document.createElement(\"div\");\n    inputsSection.className = \"ratio-finder-inputs\";\n\n    const inputsHeader = document.createElement(\"div\");\n    inputsHeader.className = \"ratio-finder-inputs-header\";\n    inputsHeader.innerHTML = `\n      <span class=\"collapse-icon\">▼</span>\n      <span>Search Parameters</span>\n    `;\n\n    const inputsContent = document.createElement(\"div\");\n    inputsContent.className = \"ratio-finder-inputs-content\";\n    inputsContent.innerHTML = this.createInputsHtml();\n\n    inputsSection.appendChild(inputsHeader);\n    inputsSection.appendChild(inputsContent);\n\n    // Results section\n    this.resultsContainer = document.createElement(\"div\");\n    this.resultsContainer.className = \"ratio-finder-results\";\n    this.resultsContainer.innerHTML =\n      '<p class=\"placeholder\">Configure inputs and click \"Find Combinations\"</p>';\n\n    // Footer with actions\n    const footer = document.createElement(\"div\");\n    footer.className = \"ratio-finder-footer\";\n    footer.innerHTML = `\n      <button id=\"ratio-finder-search\" class=\"ratio-finder-btn primary\">Find Combinations</button>\n      <button id=\"ratio-finder-cancel\" class=\"ratio-finder-btn\">Close</button>\n    `;\n\n    // Assemble modal\n    this.modal.appendChild(header);\n    this.modal.appendChild(inputsSection);\n    this.modal.appendChild(this.resultsContainer);\n    this.modal.appendChild(footer);\n\n    // Add to DOM\n    document.body.appendChild(this.overlay);\n    document.body.appendChild(this.modal);\n\n    // Store input references\n    this.storeInputReferences();\n  }\n\n  createInputsHtml(): string {\n    let html = '<div class=\"ratio-finder-input-grid\">';\n\n    for (const config of this.inputConfigs) {\n      html += `\n        <div class=\"ratio-finder-input-row\">\n          <label>${config.label}:</label>\n          <div class=\"range-inputs\">\n            <input type=\"number\" id=\"${config.id}Min\"\n                   min=\"${config.min}\" max=\"${config.max}\" step=\"${config.step}\"\n                   value=\"${config.defaultMin}\">\n            <span>to</span>\n            <input type=\"number\" id=\"${config.id}Max\"\n                   min=\"${config.min}\" max=\"${config.max}\" step=\"${config.step}\"\n                   value=\"${config.defaultMax}\">\n          </div>\n        </div>\n      `;\n    }\n\n    // Half-link checkbox\n    html += `\n      <div class=\"ratio-finder-input-row\">\n        <label>Half-link Chain:</label>\n        <input type=\"checkbox\" id=\"allowHalfLink\">\n        <span class=\"hint\">(allows odd link counts)</span>\n      </div>\n    `;\n\n    // Max Chain wear\n    html += `\n      <div class=\"ratio-finder-input-row\">\n        <label>Max Chain Wear (%):</label>\n        <div class=\"range-inputs\">\n          <input type=\"number\" id=\"maxChainWearInput\" min=\"0\" max=\"1\" step=\"0.1\" value=\"0.75\">\n        </div>\n      </div>\n    `;\n\n    // Chainring count\n    html += `\n      <div class=\"ratio-finder-input-row\">\n        <label>Chainring Count:</label>\n        <div class=\"range-inputs\">\n          <select id=\"chainringCountInput\">\n            <option value=\"1\">1</option>\n            <option value=\"2\" selected>2</option>\n            <option value=\"3\">3</option>\n          </select>\n        </div>\n      </div>\n    `;\n\n    html += \"</div>\";\n    return html;\n  }\n\n  storeInputReferences(): void {\n    for (const config of this.inputConfigs) {\n      this.inputs[config.id + \"Min\"] = document.getElementById(\n        config.id + \"Min\"\n      ) as HTMLInputElement;\n      this.inputs[config.id + \"Max\"] = document.getElementById(\n        config.id + \"Max\"\n      ) as HTMLInputElement;\n    }\n    this.inputs.allowHalfLink = document.getElementById(\n      \"allowHalfLink\"\n    ) as HTMLInputElement;\n    this.inputs.maxChainWearInput = document.getElementById(\n      \"maxChainWearInput\"\n    ) as HTMLInputElement;\n    this.inputs.chainringCountInput = document.getElementById(\n      \"chainringCountInput\"\n    ) as HTMLSelectElement;\n  }\n\n  createOpenButton(): void {\n    const sidebar = document.getElementById(\"sidebar-content\");\n    if (!sidebar) return;\n\n    const container = document.createElement(\"div\");\n    container.style.padding = \"5px\";\n    const button = document.createElement(\"button\");\n    button.id = \"openRatioFinder\";\n    button.textContent = \"Chainring Finder\";\n    button.className = \"ratio-finder-open-btn\";\n    container.appendChild(button);\n    sidebar.appendChild(container);\n  }\n\n  bindEvents(): void {\n    // Open button\n    const openBtn = document.getElementById(\"openRatioFinder\");\n    if (openBtn) {\n      openBtn.addEventListener(\"click\", () => this.open());\n    }\n\n    if (!this.modal || !this.overlay) return;\n\n    // Close buttons\n    const closeBtn = this.modal.querySelector(\".ratio-finder-close\");\n    if (closeBtn) {\n      closeBtn.addEventListener(\"click\", () => this.close());\n    }\n\n    // Drag header\n    const header = this.modal.querySelector(\".ratio-finder-header\");\n    if (header) {\n      header.addEventListener(\"mousedown\", (e) =>\n        this.onHeaderDown(e as MouseEvent)\n      );\n      header.addEventListener(\"touchstart\", (e) =>\n        this.onHeaderDown(e as TouchEvent)\n      );\n    }\n\n    const cancelBtn = document.getElementById(\"ratio-finder-cancel\");\n    if (cancelBtn) {\n      cancelBtn.addEventListener(\"click\", () => this.close());\n    }\n\n    this.overlay.addEventListener(\"click\", () => this.close());\n\n    // Collapsible inputs toggle\n    const inputsHeader = this.modal.querySelector(\".ratio-finder-inputs-header\");\n    if (inputsHeader) {\n      inputsHeader.addEventListener(\"click\", () => this.toggleInputs());\n    }\n\n    // Search button\n    const searchBtn = document.getElementById(\"ratio-finder-search\");\n    if (searchBtn) {\n      searchBtn.addEventListener(\"click\", () => this.search());\n    }\n\n    // ESC key to close\n    document.addEventListener(\"keydown\", (e) => {\n      if (e.key === \"Escape\" && this.isOpen()) {\n        this.close();\n      }\n    });\n\n    // Enter key to search\n    this.modal.addEventListener(\"keydown\", (e) => {\n      if (e.key === \"Enter\" && (e.target as HTMLElement).tagName === \"INPUT\") {\n        this.search();\n      }\n    });\n  }\n\n  open(): void {\n    if (this.overlay) this.overlay.classList.add(\"visible\");\n    if (this.modal) this.modal.classList.add(\"visible\");\n  }\n\n  close(): void {\n    if (this.overlay) this.overlay.classList.remove(\"visible\");\n    if (this.modal) this.modal.classList.remove(\"visible\");\n  }\n\n  isOpen(): boolean {\n    return this.modal?.classList.contains(\"visible\") ?? false;\n  }\n\n  toggleInputs(): void {\n    if (!this.modal) return;\n    const inputsSection = this.modal.querySelector(\".ratio-finder-inputs\");\n    if (inputsSection) {\n      inputsSection.classList.toggle(\"collapsed\");\n    }\n  }\n\n  getEventLocation(e: MouseEvent | TouchEvent): Point | undefined {\n    if (\"touches\" in e && e.touches && e.touches.length === 1) {\n      return {\n        x: e.touches[0].clientX,\n        y: e.touches[0].clientY,\n      };\n    } else if (\"clientX\" in e && e.clientX && e.clientY) {\n      return {\n        x: e.clientX,\n        y: e.clientY,\n      };\n    }\n    return undefined;\n  }\n\n  computeModalBounds(): void {\n    if (!this.modal) return;\n    const bodyRect = document.body.getBoundingClientRect();\n    const modalRect = this.modal.getBoundingClientRect();\n    this.modalMinLeft = bodyRect.x;\n    this.modalMaxLeft = bodyRect.x + bodyRect.width - modalRect.width;\n    this.modalMinTop = bodyRect.y;\n    this.modalMaxTop = bodyRect.y + bodyRect.height - modalRect.height;\n  }\n\n  onHeaderDown(e: MouseEvent | TouchEvent): void {\n    e.preventDefault();\n    this.dragStart = this.getEventLocation(e) ?? null;\n    this.computeModalBounds();\n    if (this.dragStart && this.modal) {\n      // Switch from centered transform to absolute positioning\n      const modalRect = this.modal.getBoundingClientRect();\n      this.modal.style.transform = \"none\";\n      this.modal.style.left = modalRect.left + \"px\";\n      this.modal.style.top = modalRect.top + \"px\";\n\n      // Bind handlers for cleanup\n      this.boundMouseMove = (e: MouseEvent | TouchEvent) =>\n        this.onWindowMouseMove(e);\n      this.boundMouseUp = () => this.onWindowMouseUp();\n\n      document.addEventListener(\"mouseup\", this.boundMouseUp);\n      document.addEventListener(\"touchend\", this.boundMouseUp);\n      document.addEventListener(\"mousemove\", this.boundMouseMove);\n      document.addEventListener(\"touchmove\", this.boundMouseMove, {\n        passive: false,\n      });\n    }\n  }\n\n  onWindowMouseMove(e: MouseEvent | TouchEvent): void {\n    e.preventDefault();\n    const dragEnd = this.getEventLocation(e);\n    if (dragEnd && this.dragStart && this.modal) {\n      let left = this.modal.offsetLeft + dragEnd.x - this.dragStart.x;\n      let top = this.modal.offsetTop + dragEnd.y - this.dragStart.y;\n      left = Math.max(this.modalMinLeft, Math.min(this.modalMaxLeft, left));\n      top = Math.max(this.modalMinTop, Math.min(this.modalMaxTop, top));\n      this.modal.style.left = left + \"px\";\n      this.modal.style.top = top + \"px\";\n      this.dragStart = dragEnd;\n    }\n  }\n\n  onWindowMouseUp(): void {\n    if (this.boundMouseUp) {\n      document.removeEventListener(\"mouseup\", this.boundMouseUp);\n      document.removeEventListener(\"touchend\", this.boundMouseUp);\n    }\n    if (this.boundMouseMove) {\n      document.removeEventListener(\"mousemove\", this.boundMouseMove);\n      document.removeEventListener(\"touchmove\", this.boundMouseMove);\n    }\n  }\n\n  getInputValues(): FinderInputs {\n    const inputs = this.inputs as RatioFinderInputRefs;\n    return {\n      csMin: parseFloat(inputs.csRangeMin.value),\n      csMax: parseFloat(inputs.csRangeMax.value),\n      ratioMin: parseFloat(inputs.ratioRangeMin.value),\n      ratioMax: parseFloat(inputs.ratioRangeMax.value),\n      cogMin: parseInt(inputs.cogRangeMin.value),\n      cogMax: parseInt(inputs.cogRangeMax.value),\n      chainringMin: parseInt(inputs.chainringRangeMin.value),\n      chainringMax: parseInt(inputs.chainringRangeMax.value),\n      chainLinksMin: parseInt(inputs.chainLinksRangeMin.value),\n      chainLinksMax: parseInt(inputs.chainLinksRangeMax.value),\n      allowHalfLink: inputs.allowHalfLink.checked,\n      maxChainWear: parseFloat(inputs.maxChainWearInput.value) / 100,\n      chainringCount: parseInt(inputs.chainringCountInput.value),\n    };\n  }\n\n  validateInputs(inputs: FinderInputs): string[] {\n    const errors: string[] = [];\n\n    if (inputs.csMin > inputs.csMax) {\n      errors.push(\"Chainstay min must be \\u2264 max\");\n    }\n    if (inputs.ratioMin > inputs.ratioMax) {\n      errors.push(\"Ratio min must be \\u2264 max\");\n    }\n    if (inputs.cogMin > inputs.cogMax) {\n      errors.push(\"Cog min must be \\u2264 max\");\n    }\n    if (inputs.chainringMin > inputs.chainringMax) {\n      errors.push(\"Chainring min must be \\u2264 max\");\n    }\n    if (inputs.chainLinksMin > inputs.chainLinksMax) {\n      errors.push(\"Chain links min must be \\u2264 max\");\n    }\n\n    return errors;\n  }\n\n  search(): void {\n    const inputs = this.getInputValues();\n\n    // Validate inputs\n    const errors = this.validateInputs(inputs);\n    if (errors.length > 0 && this.resultsContainer) {\n      this.resultsContainer.innerHTML = `<p class=\"no-results\">Invalid inputs:<br>${errors.join(\n        \"<br>\"\n      )}</p>`;\n      return;\n    }\n\n    this.lastInputs = inputs;\n    this.expandedRows.clear();\n\n    const results = findChainringCombos(inputs);\n    this.renderResults(results);\n  }\n\n  renderResults(results: ChainringsCombo[]): void {\n    if (!this.resultsContainer) return;\n\n    if (results.length === 0) {\n      this.resultsContainer.innerHTML =\n        '<p class=\"no-results\">No valid combinations found. Try expanding your ranges.</p>';\n      return;\n    }\n\n    let html = `\n      <table class=\"ratio-finder-table\">\n        <thead>\n          <tr>\n            <th></th>\n            <th>Chainring</th>\n            <th>Links</th>\n            <th>Ratios</th>\n            <th>Score</th>\n            <th title=\"Coverage: how much of target ratio range is achieved\">Cov</th>\n            <th title=\"Count: number of available ratios (log scale)\">Cnt</th>\n            <th title=\"Evenness: how evenly spaced the ratios are\">Even</th>\n            <th title=\"Reusability: cogs shared across chainrings\">Reuse</th>\n            <th>Max gap</th>\n          </tr>\n        </thead>\n        <tbody>\n    `;\n\n    const maxResults = 100;\n\n    // Show top maxResults results\n    const displayResults = results.slice(0, maxResults);\n\n    for (let i = 0; i < displayResults.length; i++) {\n      const combo = displayResults[i];\n      const rowId = `combo-${i}`;\n      const allCogs = combo.allCogs;\n      const validCogs = combo.allCogs\n          .filter((c) => c.ratioValid);\n\n      // Calculate min/max ratios for display\n      let ratiosDisplay = \"0\";\n      if (validCogs.length > 0) {\n        const ratios = validCogs.map((c) => c.ratio);\n        const minRatio = Math.min(...ratios).toFixed(2);\n        const maxRatio = Math.max(...ratios).toFixed(2);\n        ratiosDisplay = `${combo.ratioCount} (${minRatio} \\u2192 ${maxRatio})`;\n      }\n\n      html += `\n        <tr class=\"result-row\" data-row-id=\"${rowId}\"\n            data-chainrings=\"${combo.chainrings}\"\n            data-chainlinks=\"${combo.chainLinks}\"\n            data-index=\"${i}\">\n          <td><span class=\"expand-icon\">\\u25B6</span></td>\n          <td>${combo.chainrings.join(\",\")}T</td>\n          <td>${combo.chainLinks}</td>\n          <td>${ratiosDisplay}</td>\n          <td>${(combo.score * 100).toFixed(0)}%</td>\n          <td>${(combo.coverageScore * 100).toFixed(0)}%</td>\n          <td>${(combo.countScore * 100).toFixed(0)}%</td>\n          <td>${(combo.evennessScore * 100).toFixed(0)}%</td>\n          <td>${(combo.reusabilityScore * 100).toFixed(0)}%</td>\n          <td>${combo.maxGap.toFixed(2)}</td>\n        </tr>\n      `;\n\n      // Add expandable cog details rows\n      for (const cog of allCogs) {\n        const invalidClass = cog.ratioValid ? \"\" : \" cog-invalid\";\n        html += `\n          <tr class=\"cog-details cog-detail-row${invalidClass}\"\n              data-parent=\"${rowId}\"\n              data-chainring=\"${cog.chainring}\"\n              data-chainlinks=\"${combo.chainLinks}\"\n              data-cog=\"${cog.cog}\"\n              data-chainstay=\"${cog.chainstay.toFixed(2)}\"\n              data-chainstayWeared=\"${cog.chainstayWeared.toFixed(2)}\">\n            <td colspan=\"10\">\n              ${cog.chainring}x${cog.cog}:\n              ratio ${cog.ratio.toFixed(2)}\n              —\n              cs: ${cog.chainstay.toFixed(1)}mm\n              \\u2192 ${cog.chainstayWeared.toFixed(1)}mm (weared)\n              —\n              sp : ${cog.skidPatchesSingleLegged} / ${cog.skidPatchesAmbidextrous}\n            </td>\n          </tr>\n        `;\n      }\n    }\n\n    html += \"</tbody></table>\";\n\n    if (results.length > maxResults) {\n      html += `<p class=\"more-results\">Showing top ${maxResults} of ${results.length} combinations</p>`;\n    }\n\n    this.resultsContainer.innerHTML = html;\n\n    // Add click handlers to result rows (expand/collapse)\n    this.resultsContainer.querySelectorAll(\".result-row\").forEach((row) => {\n      row.addEventListener(\"click\", (e) =>\n        this.toggleRow(row as HTMLElement, e)\n      );\n    });\n\n    // Add click handlers to cog detail rows (apply configuration)\n    this.resultsContainer.querySelectorAll(\".cog-detail-row\").forEach((row) => {\n      row.addEventListener(\"click\", (e) => {\n        e.stopPropagation();\n        this.applyFromCogRow(row as HTMLElement);\n      });\n    });\n  }\n\n  toggleRow(row: HTMLElement, _event: Event): void {\n    const rowId = row.dataset.rowId;\n    if (!rowId || !this.resultsContainer) return;\n\n    const isExpanded = row.classList.contains(\"expanded\");\n\n    if (isExpanded) {\n      // Collapse\n      row.classList.remove(\"expanded\");\n      this.expandedRows.delete(rowId);\n      this.resultsContainer\n        .querySelectorAll(`.cog-details[data-parent=\"${rowId}\"]`)\n        .forEach((detail) => {\n          detail.classList.remove(\"visible\");\n        });\n    } else {\n      // Expand\n      row.classList.add(\"expanded\");\n      this.expandedRows.add(rowId);\n      this.resultsContainer\n        .querySelectorAll(`.cog-details[data-parent=\"${rowId}\"]`)\n        .forEach((detail) => {\n          detail.classList.add(\"visible\");\n        });\n    }\n  }\n\n  applyFromCogRow(row: HTMLElement): void {\n    const chainring = parseInt(row.dataset.chainring ?? \"0\");\n    const chainLinks = parseInt(row.dataset.chainlinks ?? \"0\");\n    const cog = parseInt(row.dataset.cog ?? \"0\");\n    const chainstay = parseFloat(row.dataset.chainstay ?? \"0\");\n\n    this.applyConfiguration(chainring, chainLinks, cog, chainstay);\n  }\n\n  applyConfiguration(\n    chainring: number,\n    chainLinks: number,\n    cog: number,\n    chainstay: number\n  ): void {\n    // Apply to main simulation state\n    this.state.f = chainring;\n    this.state.r = cog;\n    this.state.cl = chainLinks;\n    this.state.cs = chainstay;\n\n    // Reset and update simulation\n    this.main.resetComputer();\n    this.onUiUpdate();\n  }\n}\n","import BikeGearingInteractive from \"./interactive.js\";\nimport { roundHuman } from \"./math.js\";\nimport BikeGearingState from \"./state.js\";\nimport {\n  BikeGearingInputCheckbox,\n  BikeGearingInputRange,\n} from \"./ui_input.js\";\nimport RatioFinderUi from \"./ratio_finder_ui.js\";\nimport type { Point } from \"./types.js\";\n\n// Forward reference for BikeGearingMain to avoid circular dependency\ninterface MainInterface {\n  resetState(): void;\n  resetComputer(): void;\n  compute0(): void;\n  drawIfPaused(): void;\n}\n\ntype InputType = BikeGearingInputRange | BikeGearingInputCheckbox;\n\nexport default class BikeGearingUi {\n  state: BikeGearingState;\n  main: MainInterface;\n  interactive: BikeGearingInteractive;\n\n  inputs: InputType[] = [];\n  ratioFinder: RatioFinderUi;\n\n  sidebar: HTMLElement | null = null;\n  sidebarHeader: HTMLElement | null = null;\n  sidebarContent: HTMLElement | null = null;\n  sidebarHeaderButton: HTMLElement | null = null;\n  sideBarVisible: boolean = true;\n\n  initialSidebarContentHeight: number = 0;\n  initialSidebarContentWidth: number = 0;\n  initialSidebarHeight: number = 0;\n  bodyHeight: number = 0;\n\n  // Bounds for dragging\n  sidebarMinLeft: number = 0;\n  sidebarMaxLeft: number = 0;\n  sidebarMinTop: number = 0;\n  sidebarMaxTop: number = 0;\n\n  dragStart: Point | undefined;\n\n  constructor(\n    state: BikeGearingState,\n    main: MainInterface,\n    interactive: BikeGearingInteractive\n  ) {\n    this.state = state;\n    this.main = main;\n    this.interactive = interactive;\n\n    this.initInputs();\n\n    this.ratioFinder = new RatioFinderUi(state, main, () => this.update());\n  }\n\n  init(): void {\n    const resetBtn = document.getElementById(\"resetState\");\n    if (resetBtn) {\n      resetBtn.addEventListener(\"click\", () => this.resetState());\n    }\n\n    this.sidebar = document.getElementById(\"sidebar\");\n    this.sidebarHeader = document.getElementById(\"sidebar-header\");\n    this.sidebarContent = document.getElementById(\"sidebar-content\");\n\n    if (this.sidebarHeader) {\n      this.sidebarHeader.addEventListener(\"mousedown\", (e) =>\n        this.onSidebarDown(e)\n      );\n      this.sidebarHeader.addEventListener(\"touchstart\", (e) =>\n        this.onSidebarDown(e)\n      );\n    }\n\n    this.sidebarHeaderButton = document.getElementById(\"sidebar-header-button\");\n    if (this.sidebarHeaderButton) {\n      this.sidebarHeaderButton.addEventListener(\"click\", () =>\n        this.switchSidebar()\n      );\n      this.sidebarHeaderButton.addEventListener(\"touchend\", () =>\n        this.switchSidebar()\n      );\n    }\n\n    window.addEventListener(\"resize\", () => this.onResize());\n\n    // Initialize ratio finder modal before measuring sidebar dimensions\n    this.ratioFinder.init();\n\n    if (this.sidebarContent && this.sidebar) {\n      const sidebarContentRect = this.sidebarContent.getBoundingClientRect();\n      this.initialSidebarContentHeight = sidebarContentRect.height;\n      this.initialSidebarContentWidth = sidebarContentRect.width;\n      const sidebarRect = this.sidebar.getBoundingClientRect();\n      this.initialSidebarHeight = sidebarRect.height;\n      this.sidebarContent.style.height = this.initialSidebarContentHeight + \"px\";\n\n      const bodyRect = document.body.getBoundingClientRect();\n      if (bodyRect.height < this.initialSidebarContentHeight) {\n        this.sideBarVisible = false;\n      }\n      if (bodyRect.width < 2 * this.initialSidebarContentWidth) {\n        this.sideBarVisible = false;\n        this.sidebar.style.top = bodyRect.height + \"px\";\n      }\n      this.onSidebarVisibleChanged();\n      if (this.sideBarVisible) {\n        this.interactive.onSidebar(sidebarRect.width);\n      }\n    }\n  }\n\n  initInputs(): void {\n    this.inputs.push(\n      new BikeGearingInputRange(\n        \"halfLinkChain\",\n        (v) => roundHuman(parseFloat(v), 1) + \"%\",\n        () => this.state.halfLinkChain,\n        (v) => {\n          this.state.halfLinkChain = v;\n          this.main.compute0();\n        },\n        (v) => 12.7 * ((100.0 + v) / 100.0),\n        (v) => (100.0 * v) / 12.7 - 100\n      )\n    );\n    this.inputs.push(\n      new BikeGearingInputRange(\n        \"simulationSpeed\",\n        (v) => roundHuman(parseFloat(v), 0) + \"%\",\n        () => this.state.simulationSpeed,\n        (v) => (this.state.simulationSpeed = v),\n        (v) => v / 100.0,\n        (v) => v * 100.0\n      )\n    );\n\n    this.inputs.push(\n      new BikeGearingInputRange(\n        \"rotationSpeed\",\n        (v) => roundHuman(parseFloat(v), 1) + \"rpm\",\n        () => this.state.rotationSpeed,\n        (v) => (this.state.rotationSpeed = v)\n      )\n    );\n    this.inputs.push(\n      new BikeGearingInputRange(\n        \"f\",\n        (v) => \"\" + v,\n        () => this.state.f,\n        (v) => {\n          this.state.f = v;\n          this.main.resetComputer();\n        }\n      )\n    );\n    this.inputs.push(\n      new BikeGearingInputRange(\n        \"r\",\n        (v) => \"\" + v,\n        () => this.state.r,\n        (v) => {\n          this.state.r = v;\n          this.main.resetComputer();\n        }\n      )\n    );\n\n    this.inputs.push(\n      new BikeGearingInputRange(\n        \"cl\",\n        (v) => \"\" + v,\n        () => this.state.cl,\n        (cl) => this.setCl(cl)\n      )\n    );\n\n    let cs1: BikeGearingInputRange;\n    let cs2: BikeGearingInputRange;\n    cs1 = new BikeGearingInputRange(\n      \"cs1\",\n      () => roundHuman(this.state.cs, 2) + \"mm\",\n      () => Math.floor(this.state.cs),\n      (v) => {\n        this.state.cs = v;\n        cs2.reset();\n        this.main.compute0();\n      }\n    );\n    cs2 = new BikeGearingInputRange(\n      \"cs2\",\n      () => roundHuman(this.state.cs, 2) + \"mm\",\n      () => 100.0 * (this.state.cs - Math.floor(this.state.cs)),\n      (v) => {\n        this.state.cs = Math.floor(this.state.cs) + v / 100;\n        cs1.reset();\n        this.main.compute0();\n      }\n    );\n    this.inputs.push(cs1, cs2);\n\n    this.inputs.push(\n      new BikeGearingInputCheckbox(\n        \"doDrawWheel\",\n        () => this.state.doDrawWheel,\n        (v) => {\n          this.state.doDrawWheel = v;\n          this.main.drawIfPaused();\n        }\n      )\n    );\n    this.inputs.push(\n      new BikeGearingInputCheckbox(\n        \"switchPause\",\n        () => this.state.paused,\n        (v) => {\n          this.state.paused = v;\n          if (this.state.paused) {\n            this.state.fps = 0;\n          }\n          this.main.drawIfPaused();\n        }\n      )\n    );\n    this.inputs.push(\n      new BikeGearingInputCheckbox(\n        \"switchDebug\",\n        () => this.state.debug,\n        (v) => {\n          this.state.debug = v;\n          this.main.drawIfPaused();\n        }\n      )\n    );\n    this.inputs.push(\n      new BikeGearingInputCheckbox(\n        \"followRivet\",\n        () => this.state.followRivet,\n        (v) => {\n          this.state.followRivet = v;\n          this.main.drawIfPaused();\n        }\n      )\n    );\n  }\n\n  update(): void {\n    this.inputs.forEach((input) => input.reset());\n  }\n\n  setCl(cl: number): void {\n    const state = this.state;\n    const dcl = cl - state.cl;\n    const df = this.state.getRivetIndex(state.fru - state.frb);\n    const dr = this.state.getRivetIndex(state.rrb - state.rru);\n    state.cl = cl;\n    if (state.rotationSpeed > 0) {\n      state.frb = state.frb + dcl;\n      state.fru = state.frb + df;\n      state.rru = state.rrb - dr;\n    } else {\n      state.rru = state.rru + dcl;\n      state.rrb = state.rru + dr;\n      state.frb = state.fru - df;\n    }\n    this.main.compute0();\n  }\n\n  resetState(): void {\n    this.main.resetState();\n  }\n\n  getEventLocation(e: MouseEvent | TouchEvent): Point | undefined {\n    if (\"touches\" in e && e.touches && e.touches.length === 1) {\n      return {\n        x: e.touches[0].clientX,\n        y: e.touches[0].clientY,\n      };\n    } else if (\"clientX\" in e && e.clientX && e.clientY) {\n      return {\n        x: e.clientX,\n        y: e.clientY,\n      };\n    }\n    return undefined;\n  }\n\n  onResize(): void {\n    this.computeSideBarBounds();\n    if (!this.sidebar) return;\n\n    let left = this.sidebar.offsetLeft;\n    let top = this.sidebar.offsetTop;\n    left = Math.max(this.sidebarMinLeft, Math.min(this.sidebarMaxLeft, left));\n    top = Math.max(this.sidebarMinTop, Math.min(this.sidebarMaxTop, top));\n    this.sidebar.style.left = left + \"px\";\n    this.sidebar.style.top = top + \"px\";\n\n    if (this.sideBarVisible && this.sidebarContent) {\n      if (this.bodyHeight < this.initialSidebarHeight) {\n        const sidebarContentHeight =\n          this.initialSidebarContentHeight -\n          (this.initialSidebarHeight - this.bodyHeight);\n        this.sidebarContent.style.height = sidebarContentHeight + \"px\";\n      } else {\n        this.sidebarContent.style.height =\n          this.initialSidebarContentHeight + \"px\";\n      }\n    }\n  }\n\n  computeSideBarBounds(): void {\n    if (!this.sidebar) return;\n    const bodyRect = document.body.getBoundingClientRect();\n    const sidebarRect = this.sidebar.getBoundingClientRect();\n    this.bodyHeight = bodyRect.height;\n    this.sidebarMinLeft = bodyRect.x;\n    this.sidebarMaxLeft = bodyRect.x + bodyRect.width - sidebarRect.width;\n    this.sidebarMinTop = bodyRect.y;\n    this.sidebarMaxTop = bodyRect.y + bodyRect.height - sidebarRect.height;\n  }\n\n  onSidebarDown(e: MouseEvent | TouchEvent): void {\n    e.preventDefault();\n    this.dragStart = this.getEventLocation(e);\n    this.computeSideBarBounds();\n    if (this.dragStart) {\n      document.onmouseup = () => this.onWindowMouseUp();\n      document.ontouchend = () => this.onWindowMouseUp();\n      document.onmousemove = (e) => this.onWindowMouseMove(e);\n      document.ontouchmove = (e) => this.onWindowMouseMove(e);\n    }\n  }\n\n  onWindowMouseMove(e: MouseEvent | TouchEvent): void {\n    e.preventDefault();\n    const dragEnd = this.getEventLocation(e);\n    if (dragEnd && this.dragStart && this.sidebar) {\n      let left = this.sidebar.offsetLeft + dragEnd.x - this.dragStart.x;\n      let top = this.sidebar.offsetTop + dragEnd.y - this.dragStart.y;\n      left = Math.max(this.sidebarMinLeft, Math.min(this.sidebarMaxLeft, left));\n      top = Math.max(this.sidebarMinTop, Math.min(this.sidebarMaxTop, top));\n      this.sidebar.style.left = left + \"px\";\n      this.sidebar.style.top = top + \"px\";\n      this.dragStart = dragEnd;\n    }\n  }\n\n  onWindowMouseUp(): void {\n    // Legacy cleanup for older event handling\n    document.onmouseup = null;\n    document.ontouchend = null;\n    document.onmousemove = null;\n    document.ontouchmove = null;\n  }\n\n  switchSidebar(): void {\n    this.sideBarVisible = !this.sideBarVisible;\n    this.onSidebarVisibleChanged();\n  }\n\n  onSidebarVisibleChanged(): void {\n    if (!this.sidebarContent || !this.sidebarHeaderButton) return;\n\n    if (this.sideBarVisible) {\n      this.sidebarContent.style.height = \"100%\";\n      this.sidebarHeaderButton.innerText = \"\\u25B2\";\n      this.sidebarContent.style.height =\n        this.initialSidebarContentHeight + \"px\";\n    } else {\n      this.sidebarContent.style.height = \"0px\";\n      this.sidebarHeaderButton.innerText = \"\\u25BC\";\n      this.sidebarContent.style.height = \"0px\";\n    }\n    this.onResize();\n  }\n}\n","import BikeGearingState from \"./state.js\";\nimport BikeGearingMain from \"./main.js\";\nimport BikeGearingUi from \"./ui.js\";\n\nfunction initBikeGearing(): void {\n  const state = new BikeGearingState();\n  let ui: BikeGearingUi | null = null;\n  const main = new BikeGearingMain(state, \"canvas\", () => ui?.update());\n  ui = new BikeGearingUi(state, main, main.interactive);\n  main.start();\n  ui.init();\n}\n\n// Expose to global scope for HTML onload\ndeclare global {\n  interface Window {\n    initBikeGearing: () => void;\n  }\n}\n\nwindow.initBikeGearing = initBikeGearing;\n"],"names":["TWO_PI","HALF_LINK","PHYSICS_CONSTANTS","_BikeGearingPoint","x","y","r","a","p","dx","dy","BikeGearingPoint","BikeGearingCircle","c","result","dist","centroid","x2","y2","h","rx","ry","roundHuman","v","d","toDegreesHuman","comparableAngle","a1","a2","minA","maxA","reduce","numerator","denominator","gcdFn","b","gcd","computeSkidPatches","f","reduced","BikeGearingState","value","skidPatched","i","BikeGearingInteractive","canvas","main","width","worldPosition","parent","styles","w","oldCameraZoom","e","loc","_e","eventLocation","sens","scale","clientX","clientY","offset","zoom","newCameraZoom","singleTouchHandler","touch1","touch2","touchCenter","currentDistance","BikeGearingCatenary","p1","p2","l","x1","y1","inverted","ax","ay","A","diff","nPoints","points","n","dseg","dtot","iseg","dl","nd","added","BikeGearingRivetsCalculator","state","rivets","s","rc","count","BikeGearingComputer","rivetsCalculator","alpha","fdr","rdr","rdiff","label","mina","ra","maxa","fdc","rdc","r1","r2","maxDist","inter","pinter","currentRa","newRa","ir1","ir2","front","f1","f2","pm1","pp1","cam1","cap1","stepIterations","overflow","dtchrono","start","dt","rpa","fda","fra","forced","rda","distchronokm","dtchronoh","speedkmh","rotation","dtchronomin","rpm","computeDuration","aup","am","BikeGearingCogs","da","BikeGearingCogsDrawer","ctx","cogs","c1","c2","cog2","debug","BikeGearingRivetsDrawer","drawer","dcx1","dcx2","stretch","perc","BikeGearingWheelDrawer","wheel","textRadius","color","text","currentString","baseAngle","char","behindHub","BikeGearingDrawer","interactive","fill","values","maxWidth","debugValues","paused","rivetAngle","BikeGearingMain","canvasId","onReset","chrono","dchrono","BikeGearingInputRange","id","toHuman","valueGetter","valueSetter","valueFromInput","valueToInput","inputEl","target","inputValue","error","BikeGearingInputCheckbox","calculateChainstay","cl","chainWear","effectiveHalfLink","L","R","r_small","discriminant","findAllCogs","chainring","chainLinks","inputs","validCogs","cog","ratio","ratioValid","chainstay","chainstayWeared","skidPatches","COVERAGE_WEIGHT","COUNT_WEIGHT","EVENNESS_WEIGHT","REUSABILITY_WEIGHT","MAX_EXPECTED_RATIOS","calculateScore","chainringComboList","allCogs","chainringCount","chainrings","chainringCombo","ratios","minRatio","achievedRange","targetRange","gaps","maxGap","gap","coverageScore","countScore","evennessScore","idealGap","sumSquaredDev","reusabilityScore","uniqueCogs","totalUsages","maxReuse","score","combinations","arr","combinationsStrict","helper","combo","findChainringCombos","results","startLinks","linkStep","chainringComboListList","RatioFinderUi","onUiUpdate","header","inputsSection","inputsHeader","inputsContent","footer","html","config","sidebar","container","button","openBtn","closeBtn","cancelBtn","searchBtn","bodyRect","modalRect","dragEnd","left","top","errors","maxResults","displayResults","rowId","ratiosDisplay","maxRatio","invalidClass","row","_event","detail","BikeGearingUi","resetBtn","sidebarContentRect","sidebarRect","cs1","cs2","input","dcl","df","dr","sidebarContentHeight","initBikeGearing","ui"],"mappings":"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"}